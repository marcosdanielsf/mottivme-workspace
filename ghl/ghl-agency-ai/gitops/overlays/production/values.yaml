# Production environment values
# These override the base values.yaml for production deployment

replicaCount: 3

image:
  tag: "1358bfa"
  repository: ghcr.io/ghl-agency-ai/ghl-agency-ai
  pullPolicy: Always
  # tag is set by CI/CD pipeline

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
        - type: Pods
          value: 4
          periodSeconds: 15
      selectPolicy: Max

podDisruptionBudget:
  enabled: true
  minAvailable: 2

ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
  hosts:
    - host: ghl-agency-ai.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: ghl-agency-ai-production-tls
      hosts:
        - ghl-agency-ai.yourdomain.com

# Use External Secrets in production
externalSecrets:
  enabled: true
  secretStoreRef: "vault-backend"
  secretStoreKind: ClusterSecretStore
  refreshInterval: "1h"
  data:
    - secretKey: DATABASE_URL
      remoteRef:
        key: ghl-agency-ai/production/database
        property: url
    - secretKey: JWT_SECRET
      remoteRef:
        key: ghl-agency-ai/production/auth
        property: jwt_secret
    - secretKey: OAUTH_SERVER_URL
      remoteRef:
        key: ghl-agency-ai/production/auth
        property: oauth_server_url
    - secretKey: OWNER_OPEN_ID
      remoteRef:
        key: ghl-agency-ai/production/auth
        property: owner_open_id
    - secretKey: GEMINI_API_KEY
      remoteRef:
        key: ghl-agency-ai/production/ai
        property: gemini_api_key
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: ghl-agency-ai/production/ai
        property: openai_api_key
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: ghl-agency-ai/production/ai
        property: anthropic_api_key
    - secretKey: BROWSERBASE_API_KEY
      remoteRef:
        key: ghl-agency-ai/production/browserbase
        property: api_key
    - secretKey: BROWSERBASE_PROJECT_ID
      remoteRef:
        key: ghl-agency-ai/production/browserbase
        property: project_id

config:
  appId: "ghl-agency-ai-production"
  appTitle: "GHL Agency AI"
  appLogo: "/logo.png"
  oauthPortalUrl: "https://auth.manus.im"
  playwrightSkipBrowserDownload: "1"

# Browserbase configuration for production
browserbase:
  region: "us-west-2"
  stagehandModel: "google/gemini-2.0-flash"

# Session cleanup - longer interval for production (10 minutes)
sessionCleanup:
  intervalMs: 600000

# Resource quota for production namespace
resourceQuota:
  enabled: true
  hard:
    requestsCpu: "20"
    requestsMemory: "40Gi"
    limitsCpu: "40"
    limitsMemory: "80Gi"
    pods: "100"
    services: "20"
    persistentvolumeclaims: "10"
    secrets: "30"
    configmaps: "30"

env:
  NODE_ENV: production
  PORT: "3000"

networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 3000
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432  # PostgreSQL
        - protocol: TCP
          port: 443   # HTTPS APIs

serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s

affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - ghl-agency-ai
        topologyKey: kubernetes.io/hostname
  nodeAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        preference:
          matchExpressions:
            - key: node.kubernetes.io/instance-type
              operator: In
              values:
                - m5.large
                - m5.xlarge
                - m6i.large
                - m6i.xlarge
