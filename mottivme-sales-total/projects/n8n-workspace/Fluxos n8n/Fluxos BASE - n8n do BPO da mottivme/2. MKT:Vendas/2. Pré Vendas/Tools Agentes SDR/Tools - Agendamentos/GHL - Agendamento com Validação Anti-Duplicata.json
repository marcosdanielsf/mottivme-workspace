{
  "name": "GHL - Agendamento com ValidaÃ§Ã£o Anti-Duplicata",
  "nodes": [
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "telefone",
              "value": "={{ $json.telefone }}"
            },
            {
              "key": "email",
              "value": "={{ $json.email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -2128,
        2112
      ],
      "id": "f8ca7f61-51bb-42c7-a5c0-e3a352a73c9a",
      "name": "Execution Data1"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "API_KEY"
            },
            {
              "name": "email"
            },
            {
              "name": "telefone"
            },
            {
              "name": "location_id"
            },
            {
              "name": "calendar_id"
            },
            {
              "name": "startTime"
            },
            {
              "name": "firstName"
            },
            {
              "name": "lastName"
            },
            {
              "name": "lead_id"
            },
            {
              "name": "estadoValue"
            },
            {
              "name": "workPermitValue"
            }
          ]
        }
      },
      "id": "22a0ed9b-4ee6-497e-8642-61ef19791400",
      "typeVersion": 1.1,
      "name": "Start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -2352,
        2112
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "contact-id-assign",
              "name": "contact_id",
              "value": "={{ $('Search Contact por Email2').item?.json?.contacts?.[0]?.id ?? $('Search Contact por Phone3').item?.json?.contacts?.[0]?.id ?? $('Create Contact2').first().json.contact.id }}",
              "type": "string"
            },
            {
              "id": "location-id-assign",
              "name": "location_id",
              "value": "={{ $('Start').first().json.location_id }}",
              "type": "string"
            },
            {
              "id": "calendar-id-assign",
              "name": "calendar_id",
              "value": "={{ $('Start').first().json.calendar_id }}",
              "type": "string"
            },
            {
              "id": "starttime-assign",
              "name": "startTime",
              "value": "={{ $('Start').item.json.startTime }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        2304
      ],
      "id": "1dda605c-6502-4df2-9940-a24438514fdd",
      "name": "Preparar Dados Agendamento2"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=https://services.leadconnectorhq.com/contacts",
        "options": {},
        "bodyParametersUi": {
          "parameter": [
            {
              "name": "locationId",
              "value": "={{ $('Start').item.json.location_id }}"
            },
            {
              "name": "email",
              "value": "={{ $('Start').item.json.email }}"
            },
            {
              "name": "firstName",
              "value": "={{ $('Start').item.json.firstName }}"
            },
            {
              "name": "lastName",
              "value": "={{ $('Start').item.json.lastName }}"
            },
            {
              "name": "phone",
              "value": "={{ $('Start').item.json.telefone }}"
            }
          ]
        },
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-07-28"
            }
          ]
        }
      },
      "name": "Create Contact2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -336,
        2352
      ],
      "id": "846d04fb-1b0d-4229-9242-1d8e6871f2a4",
      "retryOnFail": true,
      "notes": "Cria novo contato apenas se NÃƒO existir por email NEM telefone"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "status-field-phone",
              "name": "status",
              "value": "APPOINTMENT_JA_EXISTE",
              "type": "string"
            },
            {
              "id": "message-field-phone",
              "name": "message",
              "value": "âš ï¸ Contato jÃ¡ possui agendamento. OperaÃ§Ã£o cancelada para evitar duplicata.",
              "type": "string"
            },
            {
              "id": "contact-id-field-phone",
              "name": "contact_id",
              "value": "={{ $('Search Contact por Phone3').item.json.contacts[0].id }}",
              "type": "string"
            },
            {
              "id": "contact-phone-field",
              "name": "contact_phone",
              "value": "={{ $('Search Contact por Phone3').item.json.contacts[0].phone }}",
              "type": "string"
            },
            {
              "id": "existing-appointments-field-phone",
              "name": "existing_appointments",
              "value": "={{ $json.events }}",
              "type": "array"
            },
            {
              "id": "appointment-count-field-phone",
              "name": "appointment_count",
              "value": "={{ $json.events.length }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        2128
      ],
      "id": "13b5b266-c8c1-4e5a-8c4d-9a27c9b5ab31",
      "name": "ðŸ›‘ STOP - Appointment Duplicado (Phone)2",
      "notes": "Para execuÃ§Ã£o - jÃ¡ existe agendamento para este contato"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "check-appointments-exist-phone",
              "leftValue": "={{ $json.events && $json.events.length > 0 }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -336,
        2112
      ],
      "id": "26f25d75-70a6-4d92-9faf-6b47faf1afe6",
      "name": "IF - JÃ¡ Tem Appointment? (Phone)2",
      "notes": "Verifica se jÃ¡ existe appointment agendado"
    },
    {
      "parameters": {
        "url": "=https://services.leadconnectorhq.com/contacts/{{ $json.contacts[0].id }}/appointments",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            }
          ]
        }
      },
      "name": "Buscar Appointments (Phone)3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -560,
        2112
      ],
      "id": "fe384513-6cab-479f-bf67-d60fcef3caaa",
      "continueOnFail": true,
      "notes": "Busca appointments do contato encontrado por TELEFONE"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e54ae733-9f48-415b-9402-bcbbdd268754",
              "leftValue": "={{ $json.contacts?.[0]?.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -784,
        2208
      ],
      "id": "5349cf8f-fb46-4b49-a98d-cdcd101161d1",
      "name": "IF - Encontrou por Telefone?3",
      "notes": "Verifica se encontrou contato por TELEFONE"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=https://services.leadconnectorhq.com/contacts/search",
        "options": {},
        "bodyParametersUi": {
          "parameter": [
            {
              "name": "locationId",
              "value": "={{ $('Start').item.json.location_id }}"
            },
            {
              "name": "pageLimit",
              "value": "={{ 20 }}"
            },
            {
              "name": "query",
              "value": "={{ $('Start').item.json.telefone }}"
            }
          ]
        },
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-07-28"
            }
          ]
        }
      },
      "name": "Search Contact por Phone3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -1008,
        2208
      ],
      "id": "07c329ee-8149-4888-be8b-9045d05abd79",
      "notes": "Busca contato por TELEFONE se nÃ£o encontrou por email"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "status-field",
              "name": "status",
              "value": "APPOINTMENT_JA_EXISTE",
              "type": "string"
            },
            {
              "id": "message-field",
              "name": "message",
              "value": "âš ï¸ Contato jÃ¡ possui agendamento. OperaÃ§Ã£o cancelada para evitar duplicata.",
              "type": "string"
            },
            {
              "id": "contact-id-field",
              "name": "contact_id",
              "value": "={{ $('Search Contact por Email2').item.json.contacts[0].id }}",
              "type": "string"
            },
            {
              "id": "contact-email-field",
              "name": "contact_email",
              "value": "={{ $('Search Contact por Email2').item.json.contacts[0].email }}",
              "type": "string"
            },
            {
              "id": "existing-appointments-field",
              "name": "existing_appointments",
              "value": "={{ $json.events }}",
              "type": "array"
            },
            {
              "id": "appointment-count-field",
              "name": "appointment_count",
              "value": "={{ $json.events.length }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -976,
        1856
      ],
      "id": "57721edd-0ff3-4278-ad59-1dc3a019684b",
      "name": "ðŸ›‘ STOP - Appointment Duplicado5",
      "notes": "Para execuÃ§Ã£o - jÃ¡ existe agendamento para este contato"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "check-appointments-exist",
              "leftValue": "={{ $json.events && $json.events.length > 0 }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1232,
        2032
      ],
      "id": "c6071808-64c0-4b44-9bc8-a68ee848096c",
      "name": "IF - JÃ¡ Tem Appointment? (Email)2",
      "notes": "Verifica se jÃ¡ existe appointment agendado"
    },
    {
      "parameters": {
        "url": "=https://services.leadconnectorhq.com/contacts/{{ $json.contacts[0].id }}/appointments",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            }
          ]
        }
      },
      "name": "Buscar Appointments (Email)2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -1456,
        2032
      ],
      "id": "905e2e63-583f-4d11-8ba1-a313068f574b",
      "continueOnFail": true,
      "notes": "Busca appointments do contato encontrado por EMAIL"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e54ae733-9f48-415b-9402-bcbbdd268754",
              "leftValue": "={{ $json.contacts?.[0]?.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1680,
        2112
      ],
      "id": "79f3cc68-a826-4c31-9847-c67cf4a7d396",
      "name": "IF - Encontrou por Email?2",
      "notes": "Valida se encontrou contato por EMAIL antes de buscar appointments"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "=https://services.leadconnectorhq.com/contacts/search",
        "options": {},
        "bodyParametersUi": {
          "parameter": [
            {
              "name": "locationId",
              "value": "={{ $json.location_id }}"
            },
            {
              "name": "pageLimit",
              "value": "={{ 20 }}"
            },
            {
              "name": "query",
              "value": "={{ $json.email }}"
            }
          ]
        },
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-07-28"
            }
          ]
        }
      },
      "name": "Search Contact por Email2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -1904,
        2112
      ],
      "id": "e58948f3-5ac7-40d5-bd62-bad5fd4b6b5a",
      "notes": "Busca contato por EMAIL"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-sucesso",
              "leftValue": "={{ $json.statusCode }}",
              "rightValue": 200,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "condition-sucesso-2",
              "leftValue": "={{ $json.statusCode }}",
              "rightValue": 299,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        560,
        2304
      ],
      "id": "c56c7df1-4fa3-4c7c-b7dc-a91fcc301086",
      "name": "Sucesso?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/calendars/events/appointments",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"calendarId\": \"{{ $json.calendar_id }}\",\n  \"locationId\": \"{{ $json.location_id }}\",\n  \"startTime\": \"{{ $json.startTime }}\",\n  \"contactId\": \"{{ $json.contact_id }}\"\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "name": "Agendar_reuniao3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        336,
        2304
      ],
      "id": "0375ea50-e934-414a-a7ff-483c6a5d0e17",
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// No node \"Code\" do n8n\nconst timezoneOffset = '-05:00'; // Ajuste conforme necessÃ¡rio\n\nconst items = $input.all();\n\nreturn items.map(item => {\n  const data = item.json;\n  \n  // Verifica se startTime existe\n  if (!data.startTime) {\n    return item;\n  }\n  \n  // Verifica se jÃ¡ tem timezone\n  const hasTimezone = /[+-]\\d{2}:\\d{2}$|Z$/.test(data.startTime);\n  \n  // Se nÃ£o tem, adiciona\n  if (!hasTimezone) {\n    data.startTime = `${data.startTime}${timezoneOffset}`;\n  }\n  \n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        2304
      ],
      "id": "d644c10c-a5df-490d-9d88-11620620cb45",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://services.leadconnectorhq.com/contacts/{{ $json.contact_id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"state\": \"{{ $('Start').item.json.estadoValue }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        832,
        2192
      ],
      "id": "143f55f4-ee22-43a9-9a50-7a5ac281009f",
      "name": "Atualizar Estado"
    },
    {
      "parameters": {
        "url": "=https://services.leadconnectorhq.com/locations/{{ $('Start').item.json.location_id }}/customFields",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-07-28"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1008,
        2208
      ],
      "id": "c127e645-2b29-4638-8abe-04cf37aba08f",
      "name": "Listar Campos Customizados"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "field-work-permit",
              "name": "workPermitFieldId",
              "value": "={{ $json.customFields.find(f => f.name.toLowerCase().includes('work permit') || f.fieldKey.includes('work_permit'))?.id }}",
              "type": "string"
            },
            {
              "id": "contact-id",
              "name": "contactId",
              "value": "={{ $('Atualizar Estado').item.json.contact.id }}",
              "type": "string"
            },
            {
              "id": "work-permit-value",
              "name": "workPermitValue",
              "value": "={{ $('Start').item.json.workPermitValue }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        2208
      ],
      "id": "95e0f546-8b18-43c1-847a-5a4c4f825525",
      "name": "Preparar Work Permit"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.workPermitValue }}",
                    "rightValue": "Possui Work Permit",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "work-permit-sim"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Possui Work Permit"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "work-permit-nao",
                    "leftValue": "={{ $json.workPermitValue }}",
                    "rightValue": "Sim",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nao Possui Work Permit"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1456,
        2208
      ],
      "id": "9db9124d-ab70-4e64-8d84-988173386cd4",
      "name": "Switch Work Permit"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://services.leadconnectorhq.com/contacts/{{ $('Atualizar Estado').item.json.contact.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"customFields\": [\n    {\n      \"id\": \"{{ $json.workPermitFieldId }}\",\n      \"value\": \"Sim\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1680,
        2112
      ],
      "id": "bd1ca899-ba44-4eda-9b7d-5ab2bb4cfc92",
      "name": "Atualizar Work Permit - Sim"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://services.leadconnectorhq.com/contacts/{{ $json.contactId }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Start').item.json.API_KEY }}"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"customFields\": [\n    {\n      \"id\": \"{{ $json.workPermitFieldId }}\",\n      \"value\": \"Nao\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1680,
        2304
      ],
      "id": "a009f63f-b675-4264-9738-5b4efcada866",
      "name": "Atualizar Work Permit - Nao"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"type\": \"SMS\",\n  \"contactId\": \"vjLP5amnYJNxzjQTVAu7\",\n  \"message\": \"Erro ao agendar reuniao\\n\\nLead: {{ $('Start').item.json.email }}\\nHorario tentado: {{ $('Start').item.json.startTime }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        784,
        2400
      ],
      "id": "2e62d416-f3b9-43fc-ba77-b9ce0d6f247b",
      "name": "Whatsapp Erro1",
      "retryOnFail": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        704,
        2112
      ],
      "id": "1d44119b-c40a-44df-9844-7ff1c421cf86",
      "name": "Merge"
    }
  ],
  "pinData": {
    "Start": [
      {
        "json": {
          "API_KEY": "pit-3d61b334-690f-46ad-a6be-54c5efce1f46",
          "email": "Kdossantos78usa@gmail.com",
          "telefone": "+10000000000",
          "location_id": "EKHxHl3KLPN0iRc69GNU",
          "calendar_id": "eEWo8aXNwp2Tm4DY3jYS",
          "startTime": "2025-12-12T20:00:00",
          "firstName": "Kelly",
          "lastName": "Dos Santos",
          "lead_id": "23697321",
          "estadoValue": "NJ",
          "workPermitValue": "Possui Work Permit"
        }
      }
    ]
  },
  "connections": {
    "Execution Data1": {
      "main": [
        [
          {
            "node": "Search Contact por Email2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Start": {
      "main": [
        [
          {
            "node": "Execution Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Dados Agendamento2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Contact2": {
      "main": [
        [
          {
            "node": "Preparar Dados Agendamento2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - JÃ¡ Tem Appointment? (Phone)2": {
      "main": [
        [
          {
            "node": "ðŸ›‘ STOP - Appointment Duplicado (Phone)2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Preparar Dados Agendamento2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Appointments (Phone)3": {
      "main": [
        [
          {
            "node": "IF - JÃ¡ Tem Appointment? (Phone)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Encontrou por Telefone?3": {
      "main": [
        [
          {
            "node": "Buscar Appointments (Phone)3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Contact2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Contact por Phone3": {
      "main": [
        [
          {
            "node": "IF - Encontrou por Telefone?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - JÃ¡ Tem Appointment? (Email)2": {
      "main": [
        [
          {
            "node": "ðŸ›‘ STOP - Appointment Duplicado5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Preparar Dados Agendamento2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Appointments (Email)2": {
      "main": [
        [
          {
            "node": "IF - JÃ¡ Tem Appointment? (Email)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Encontrou por Email?2": {
      "main": [
        [
          {
            "node": "Buscar Appointments (Email)2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search Contact por Phone3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Contact por Email2": {
      "main": [
        [
          {
            "node": "IF - Encontrou por Email?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sucesso?": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Whatsapp Erro1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agendar_reuniao3": {
      "main": [
        [
          {
            "node": "Sucesso?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Agendar_reuniao3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar Estado": {
      "main": [
        [
          {
            "node": "Listar Campos Customizados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listar Campos Customizados": {
      "main": [
        [
          {
            "node": "Preparar Work Permit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Work Permit": {
      "main": [
        [
          {
            "node": "Switch Work Permit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Work Permit": {
      "main": [
        [
          {
            "node": "Atualizar Work Permit - Sim",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualizar Work Permit - Nao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ›‘ STOP - Appointment Duplicado5": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Atualizar Estado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "WnRF9AdjFBkEW9Ma"
  },
  "versionId": "1b15246c-0046-45b9-a76c-3d09c5b287bf",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9d65e6caa0e89e696b77790e020391d74468b15f71b3dcdb63aad81f090f5e69"
  },
  "id": "wfPnrT2wLBFo1j1Z",
  "tags": [
    {
      "updatedAt": "2025-11-03T19:28:46.270Z",
      "createdAt": "2025-11-03T19:28:46.270Z",
      "id": "3znkt8vlq1yubGAB",
      "name": "on"
    }
  ]
}