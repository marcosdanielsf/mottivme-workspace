{
  "name": "Trilha Editorial 30 Dias - 2 Partes",
  "nodes": [
    {
      "parameters": {},
      "id": "start-node",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Crie uma trilha editorial estratÃ©gica de 15 dias (PRIMEIRA QUINZENA).\n\n**DADOS DO EXPERT:**\n\nNome: {{ $json.expert_name }}\nID: {{ $json.expert_id }}\nDATA: {{ $now.format('FFFF') }}  \n\n**CONFIGURAÃ‡ÃƒO:**\nFormalidade: {{ $json.formality }}/10\nArquÃ©tipo Principal: {{ $json.arquetipo_principal }} - {{ $json.expert_data.arquetipo_principal.percentage }}/100\nArquÃ©tipo SecundÃ¡rio: {{ $json.expert_data.arquetipo_secundario.name }} - {{ $json.expert_data.arquetipo_secundario.percentage }}/100\n\n**POSICIONAMENTO:**\nPromessa: {{ $json.promessa }}\nMecanismo: {{ $json.mecanismo }}\nDiferenciaÃ§Ã£o: {{ $json.diferenciacao }}\nPropÃ³sito: {{ $json.proposito }}\nMissÃ£o: {{ $json.missao }}\n\n**VALORES CORE:**\n{{ $json.core_value_nome }} - {{ $json.core_value_manifestacao }}\nSupporting Values:\n{{ $json.supporting_values_formatados }}",
        "options": {
          "systemMessage": "VocÃª Ã© um estrategista de conteÃºdo especializado em criar trilhas editoriais para experts.\n\n**SUA MISSÃƒO:**\nCriar a PRIMEIRA QUINZENA (dias 1-15) de uma trilha editorial estratÃ©gica que:\n1. Posicione o expert como autoridade\n2. Eduque o pÃºblico-alvo progressivamente\n3. Prepare para conversÃ£o\n4. Mantenha engajamento consistente\n\nâš ï¸ **IMPORTANTE**: VocÃª estÃ¡ criando APENAS OS PRIMEIROS 15 DIAS. HaverÃ¡ uma segunda parte (dias 16-30).\n\n---\n\n## FRAMEWORK: TRILHA EDITORIAL PARTE 1 (DIAS 1-15)\n\n### **Estrutura dos 15 Dias:**\n\n**Dias 1-4: AWARENESS (ConsciÃªncia do Problema)**\n- Dias 1-2: Expor o problema que o avatar enfrece\n- Dias 3-4: Agitar a dor, mostrar consequÃªncias\n\n**Dias 5-8: EDUCAÃ‡ÃƒO (Mostrar o Novo Caminho)**\n- Dias 5-6: Introduzir conceitos-chave do mÃ©todo\n- Dias 7-8: Desconstruir crenÃ§as limitantes\n\n**Dias 9-12: DIFERENCIAÃ‡ÃƒO (Por Que Este Expert)**\n- Dias 9-10: Demonstrar diferenciaÃ§Ã£o/Ãºnico\n- Dias 11-12: Prova social, resultados, autoridade\n\n**Dias 13-15: TRANSIÃ‡ÃƒO PARA CONVERSÃƒO**\n- Dia 13: Mostrar caminho claro\n- Dia 14: UrgÃªncia suave\n- Dia 15: Preparar para segunda quinzena (conversÃ£o)\n\n---\n\n## FORMATO DE SAÃDA\n\nRetorne APENAS JSON vÃ¡lido COM OS 15 DIAS COMPLETOS:\n\n```json\n{\n  \"trilha_editorial\": [\n    {\n      \"dia\": 1,\n      \"data_sugerida\": \"2025-11-24\",\n      \"dia_semana\": \"Segunda\",\n      \"fase\": \"Awareness\",\n      \"pilar\": \"Problema/Dor\",\n      \"tema\": \"tÃ­tulo descritivo do tema\",\n      \"angulo\": \"Ã¢ngulo especÃ­fico a abordar\",\n      \"formato_primario\": \"Reel / Story / Carrossel / Post\",\n      \"duracao_estimada\": \"15s / 30s / 60s / N/A\",\n      \"objetivo\": \"qual comportamento queremos\",\n      \"metrica_sucesso\": \"views / engajamento / saves / shares / agendamentos\",\n      \"gatilho_mental\": \"qual gatilho usar\",\n      \"cta_tipo\": \"suave / moderado / forte / nenhum\",\n      \"cta_texto\": \"texto do CTA\",\n      \"pontos_chave\": [\n        \"ponto 1 a abordar\",\n        \"ponto 2 a abordar\",\n        \"ponto 3 a abordar\"\n      ],\n      \"hook_sugerido\": \"exemplo de hook que funciona\",\n      \"temperatura_lead\": \"frio / morno / quente\"\n    }\n  ],\n  \"expert_id\": \"[id]\",\n  \"expert_name\": \"[nome]\",\n  \"estrategia_resumo\": {\n    \"objetivo_quinzena\": \"descriÃ§Ã£o do objetivo dos primeiros 15 dias\",\n    \"pilares_dominantes\": [\"pilar1\", \"pilar2\", \"pilar3\"],\n    \"distribuicao_formatos\": {\n      \"reels\": \"X%\",\n      \"stories\": \"X%\",\n      \"carrosseis\": \"X%\",\n      \"posts\": \"X%\"\n    },\n    \"kpis_quinzena\": [\n      \"KPI 1 esperado\",\n      \"KPI 2 esperado\",\n      \"KPI 3 esperado\"\n    ]\n  },\n  \"insights_estrategicos\": {\n    \"semana_1\": \"insight sobre a primeira semana (dias 1-7)\",\n    \"semana_2\": \"insight sobre primeira metade da segunda semana (dias 8-15)\"\n  },\n  \"parte\": 1,\n  \"total_partes\": 2\n}\n```\n\nâš ï¸ **CRÃTICO**: RETORNE OS 15 DIAS COMPLETOS. NÃƒO TRUNCAR. SE NECESSÃRIO, SEJA MAIS CONCISO NOS TEXTOS, MAS RETORNE TODOS OS 15 DIAS."
        }
      },
      "id": "agente-parte-1",
      "name": "Agente Parte 1 (Dias 1-15)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        460,
        200
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Crie a continuaÃ§Ã£o da trilha editorial estratÃ©gica: dias 16-30 (SEGUNDA QUINZENA).\n\n**DADOS DO EXPERT:**\n\nNome: {{ $json.expert_name }}\nID: {{ $json.expert_id }}\nDATA: {{ $now.format('FFFF') }}  \n\n**CONFIGURAÃ‡ÃƒO:**\nFormalidade: {{ $json.formality }}/10\nArquÃ©tipo Principal: {{ $json.arquetipo_principal }} - {{ $json.expert_data.arquetipo_principal.percentage }}/100\nArquÃ©tipo SecundÃ¡rio: {{ $json.expert_data.arquetipo_secundario.name }} - {{ $json.expert_data.arquetipo_secundario.percentage }}/100\n\n**POSICIONAMENTO:**\nPromessa: {{ $json.promessa }}\nMecanismo: {{ $json.mecanismo }}\nDiferenciaÃ§Ã£o: {{ $json.diferenciacao }}\nPropÃ³sito: {{ $json.proposito }}\nMissÃ£o: {{ $json.missao }}\n\n**VALORES CORE:**\n{{ $json.core_value_nome }} - {{ $json.core_value_manifestacao }}\nSupporting Values:\n{{ $json.supporting_values_formatados }}",
        "options": {
          "systemMessage": "VocÃª Ã© um estrategista de conteÃºdo especializado em criar trilhas editoriais para experts.\n\n**SUA MISSÃƒO:**\nCriar a SEGUNDA QUINZENA (dias 16-30) de uma trilha editorial estratÃ©gica que:\n1. Continue o aquecimento da primeira quinzena\n2. Intensifique a conversÃ£o\n3. Supere objeÃ§Ãµes\n4. Facilite a decisÃ£o\n\nâš ï¸ **IMPORTANTE**: VocÃª estÃ¡ criando a CONTINUAÃ‡ÃƒO (dias 16-30). Os dias 1-15 jÃ¡ foram criados na primeira parte.\n\n---\n\n## FRAMEWORK: TRILHA EDITORIAL PARTE 2 (DIAS 16-30)\n\n### **Estrutura dos 15 Dias:**\n\n**Dias 16-18: REFORÃ‡O DE DIFERENCIAÃ‡ÃƒO**\n- Dia 16: ComparaÃ§Ã£o com abordagens tradicionais\n- Dia 17: Por que outros mÃ©todos falham\n- Dia 18: O que torna este mÃ©todo Ãºnico\n\n**Dias 19-22: PROVA SOCIAL INTENSIVA**\n- Dia 19-20: Cases detalhados de transformaÃ§Ã£o\n- Dia 21: Depoimentos/resultados especÃ­ficos\n- Dia 22: Autoridade/credenciais\n\n**Dias 23-26: CONVERSÃƒO DIRETA**\n- Dia 23: UrgÃªncia (se genuÃ­no)\n- Dia 24: Escassez (se genuÃ­no)\n- Dia 25: Superar objeÃ§Ã£o #1\n- Dia 26: Superar objeÃ§Ã£o #2\n\n**Dias 27-30: FACILITAR DECISÃƒO**\n- Dia 27: PrÃ³ximo passo claro\n- Dia 28: CTA forte\n- Dia 29: Ãšltimo empurrÃ£o\n- Dia 30: RecapitulaÃ§Ã£o + CTA final\n\n---\n\n## FORMATO DE SAÃDA\n\nRetorne APENAS JSON vÃ¡lido COM OS 15 DIAS COMPLETOS (16-30):\n\n```json\n{\n  \"trilha_editorial\": [\n    {\n      \"dia\": 16,\n      \"data_sugerida\": \"2025-12-08\",\n      \"dia_semana\": \"Segunda\",\n      \"fase\": \"DiferenciaÃ§Ã£o\",\n      \"pilar\": \"ComparaÃ§Ã£o/Contraste\",\n      \"tema\": \"tÃ­tulo descritivo do tema\",\n      \"angulo\": \"Ã¢ngulo especÃ­fico a abordar\",\n      \"formato_primario\": \"Reel / Story / Carrossel / Post\",\n      \"duracao_estimada\": \"15s / 30s / 60s / N/A\",\n      \"objetivo\": \"qual comportamento queremos\",\n      \"metrica_sucesso\": \"views / engajamento / saves / shares / agendamentos\",\n      \"gatilho_mental\": \"qual gatilho usar\",\n      \"cta_tipo\": \"suave / moderado / forte\",\n      \"cta_texto\": \"texto do CTA\",\n      \"pontos_chave\": [\n        \"ponto 1 a abordar\",\n        \"ponto 2 a abordar\",\n        \"ponto 3 a abordar\"\n      ],\n      \"hook_sugerido\": \"exemplo de hook que funciona\",\n      \"temperatura_lead\": \"quente\",\n      \"objecao_abordada\": \"qual objeÃ§Ã£o este dia supera (se aplicÃ¡vel)\"\n    }\n  ],\n  \"expert_id\": \"[id]\",\n  \"expert_name\": \"[nome]\",\n  \"estrategia_resumo\": {\n    \"objetivo_quinzena\": \"descriÃ§Ã£o do objetivo dos Ãºltimos 15 dias\",\n    \"pilares_dominantes\": [\"pilar1\", \"pilar2\", \"pilar3\"],\n    \"distribuicao_formatos\": {\n      \"reels\": \"X%\",\n      \"stories\": \"X%\",\n      \"carrosseis\": \"X%\",\n      \"posts\": \"X%\"\n    },\n    \"kpis_quinzena\": [\n      \"Agendamentos\",\n      \"Taxa de conversÃ£o\",\n      \"Vendas geradas\"\n    ],\n    \"objecoes_superadas\": [\n      \"ObjeÃ§Ã£o 1\",\n      \"ObjeÃ§Ã£o 2\",\n      \"ObjeÃ§Ã£o 3\"\n    ]\n  },\n  \"insights_estrategicos\": {\n    \"semana_3\": \"insight sobre segunda metade da segunda semana (dias 16-21)\",\n    \"semana_4\": \"insight sobre a Ãºltima semana (dias 22-30)\"\n  },\n  \"parte\": 2,\n  \"total_partes\": 2\n}\n```\n\nâš ï¸ **CRÃTICO**: \n1. COMECE DO DIA 16 (nÃ£o do dia 1!)\n2. RETORNE OS 15 DIAS COMPLETOS (16-30)\n3. NÃƒO TRUNCAR"
        }
      },
      "id": "agente-parte-2",
      "name": "Agente Parte 2 (Dias 16-30)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        460,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "const agentOutput = $input.item.json.output;\n\nlet cleaned = typeof agentOutput === 'string'\n  ? agentOutput.replace(/```json\\s*/g, '').replace(/```\\s*/g, '').trim()\n  : JSON.stringify(agentOutput);\n\nconsole.log('ðŸ“ Tamanho do output:', cleaned.length);\n\nfunction forceCloseJSON(jsonStr) {\n  console.log('ðŸ”§ ForÃ§ando fechamento de JSON truncado...');\n  const lines = jsonStr.split('\\n');\n  let validJSON = '';\n  let lastValidLine = -1;\n\n  for (let i = lines.length - 1; i >= 0; i--) {\n    const line = lines[i].trim();\n    if (!line || line === '{' || line === '[' || line === ',') continue;\n    if (line.match(/[\",\\}\\]]$/)) {\n      lastValidLine = i;\n      break;\n    }\n  }\n\n  if (lastValidLine > 0) {\n    validJSON = lines.slice(0, lastValidLine + 1).join('\\n');\n    validJSON = validJSON.replace(/,(\\s*[\\}\\]])$/, '$1');\n  } else {\n    validJSON = jsonStr;\n  }\n\n  let openBraces = 0, closeBraces = 0, openBrackets = 0, closeBrackets = 0;\n  let inString = false, escaped = false;\n\n  for (let i = 0; i < validJSON.length; i++) {\n    const char = validJSON[i];\n    if (char === '\\\\' && !escaped) { escaped = true; continue; }\n    if (char === '\"' && !escaped) inString = !inString;\n    if (!inString) {\n      if (char === '{') openBraces++;\n      if (char === '}') closeBraces++;\n      if (char === '[') openBrackets++;\n      if (char === ']') closeBrackets++;\n    }\n    escaped = false;\n  }\n\n  let closers = '';\n  const quoteCount = (validJSON.match(/\"/g) || []).length;\n  if (quoteCount % 2 !== 0) closers += '\"';\n  if (openBrackets > closeBrackets) closers += '\\n' + '    ]'.repeat(openBrackets - closeBrackets);\n  if (openBraces > closeBraces) closers += '\\n' + '  }'.repeat(openBraces - closeBraces);\n\n  return validJSON + closers;\n}\n\ntry {\n  const fixed = forceCloseJSON(cleaned);\n  const parsed = JSON.parse(fixed);\n  console.log('âœ… PARSE BEM-SUCEDIDO!');\n  console.log(`ðŸ“… Dias recuperados: ${parsed.trilha_editorial?.length || 0}`);\n  return processarTrilha(parsed);\n} catch (parseError) {\n  console.error('âŒ Parse falhou:', parseError.message);\n  return {\n    json: {\n      parsing_status: 'error',\n      error_message: 'JSON truncado - agente nÃ£o completou os 15 dias',\n      trilha_texto: 'âš ï¸ ERRO: Veja logs',\n      trilha_json: '[]',\n      expert_id: 'error',\n      total_dias: 0,\n      data_geracao: new Date().toISOString()\n    }\n  };\n}\n\nfunction processarTrilha(parsed) {\n  const trilhaArray = parsed.trilha_editorial || [];\n  const diasComReels = trilhaArray.filter(d => d.formato_primario === 'Reel');\n\n  const trilhaFormatada = trilhaArray.map(dia =>\n    `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n` +\n    `ðŸ“… DIA ${dia.dia} | ${dia.dia_semana} ${dia.data_sugerida}\\n` +\n    `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n` +\n    `ðŸŽ¯ FASE: ${dia.fase}\\n` +\n    `ðŸ“Œ PILAR: ${dia.pilar}\\n` +\n    `ðŸ“ TEMA: ${dia.tema}\\n` +\n    `ðŸŽ¬ FORMATO: ${dia.formato_primario}\\n` +\n    `ðŸª HOOK: \"${dia.hook_sugerido || 'N/A'}\"\\n`\n  ).join('\\n\\n');\n\n  const stats = {\n    total_dias: trilhaArray.length,\n    total_reels: diasComReels.length,\n    total_stories: trilhaArray.filter(d => d.formato_primario === 'Story').length,\n    total_carrosseis: trilhaArray.filter(d => d.formato_primario === 'Carrossel').length\n  };\n\n  const aviso = trilhaArray.length < 15\n    ? `\\n\\nâš ï¸ Trilha incompleta! ${trilhaArray.length}/15 dias.`\n    : '';\n\n  return {\n    json: {\n      trilha_texto: trilhaFormatada + aviso,\n      trilha_json: JSON.stringify(trilhaArray, null, 2),\n      trilha_completa_json: JSON.stringify(parsed, null, 2),\n      dias_reels_json: JSON.stringify(diasComReels, null, 2),\n      expert_id: parsed.expert_id || 'unknown',\n      expert_name: parsed.expert_name || 'Unknown',\n      total_dias: stats.total_dias,\n      total_reels: stats.total_reels,\n      stats: stats,\n      data_geracao: new Date().toISOString(),\n      parsing_status: 'success',\n      parsing_warning: trilhaArray.length < 15 ? 'trilha_incompleta' : null\n    }\n  };\n}"
      },
      "id": "parse-parte-1",
      "name": "Parse Trilha - Parte 1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "const agentOutput = $input.item.json.output;\n\nlet cleaned = typeof agentOutput === 'string'\n  ? agentOutput.replace(/```json\\s*/g, '').replace(/```\\s*/g, '').trim()\n  : JSON.stringify(agentOutput);\n\nconsole.log('ðŸ“ Tamanho do output:', cleaned.length);\n\nfunction forceCloseJSON(jsonStr) {\n  console.log('ðŸ”§ ForÃ§ando fechamento de JSON truncado...');\n  const lines = jsonStr.split('\\n');\n  let validJSON = '';\n  let lastValidLine = -1;\n\n  for (let i = lines.length - 1; i >= 0; i--) {\n    const line = lines[i].trim();\n    if (!line || line === '{' || line === '[' || line === ',') continue;\n    if (line.match(/[\",\\}\\]]$/)) {\n      lastValidLine = i;\n      break;\n    }\n  }\n\n  if (lastValidLine > 0) {\n    validJSON = lines.slice(0, lastValidLine + 1).join('\\n');\n    validJSON = validJSON.replace(/,(\\s*[\\}\\]])$/, '$1');\n  } else {\n    validJSON = jsonStr;\n  }\n\n  let openBraces = 0, closeBraces = 0, openBrackets = 0, closeBrackets = 0;\n  let inString = false, escaped = false;\n\n  for (let i = 0; i < validJSON.length; i++) {\n    const char = validJSON[i];\n    if (char === '\\\\' && !escaped) { escaped = true; continue; }\n    if (char === '\"' && !escaped) inString = !inString;\n    if (!inString) {\n      if (char === '{') openBraces++;\n      if (char === '}') closeBraces++;\n      if (char === '[') openBrackets++;\n      if (char === ']') closeBrackets++;\n    }\n    escaped = false;\n  }\n\n  let closers = '';\n  const quoteCount = (validJSON.match(/\"/g) || []).length;\n  if (quoteCount % 2 !== 0) closers += '\"';\n  if (openBrackets > closeBrackets) closers += '\\n' + '    ]'.repeat(openBrackets - closeBrackets);\n  if (openBraces > closeBraces) closers += '\\n' + '  }'.repeat(openBraces - closeBraces);\n\n  return validJSON + closers;\n}\n\ntry {\n  const fixed = forceCloseJSON(cleaned);\n  const parsed = JSON.parse(fixed);\n  console.log('âœ… PARSE BEM-SUCEDIDO!');\n  console.log(`ðŸ“… Dias recuperados: ${parsed.trilha_editorial?.length || 0}`);\n  return processarTrilha(parsed);\n} catch (parseError) {\n  console.error('âŒ Parse falhou:', parseError.message);\n  return {\n    json: {\n      parsing_status: 'error',\n      error_message: 'JSON truncado - agente nÃ£o completou os 15 dias',\n      trilha_texto: 'âš ï¸ ERRO: Veja logs',\n      trilha_json: '[]',\n      expert_id: 'error',\n      total_dias: 0,\n      data_geracao: new Date().toISOString()\n    }\n  };\n}\n\nfunction processarTrilha(parsed) {\n  const trilhaArray = parsed.trilha_editorial || [];\n  const diasComReels = trilhaArray.filter(d => d.formato_primario === 'Reel');\n\n  const trilhaFormatada = trilhaArray.map(dia =>\n    `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n` +\n    `ðŸ“… DIA ${dia.dia} | ${dia.dia_semana} ${dia.data_sugerida}\\n` +\n    `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n` +\n    `ðŸŽ¯ FASE: ${dia.fase}\\n` +\n    `ðŸ“Œ PILAR: ${dia.pilar}\\n` +\n    `ðŸ“ TEMA: ${dia.tema}\\n` +\n    `ðŸŽ¬ FORMATO: ${dia.formato_primario}\\n` +\n    `ðŸª HOOK: \"${dia.hook_sugerido || 'N/A'}\"\\n`\n  ).join('\\n\\n');\n\n  const stats = {\n    total_dias: trilhaArray.length,\n    total_reels: diasComReels.length,\n    total_stories: trilhaArray.filter(d => d.formato_primario === 'Story').length,\n    total_carrosseis: trilhaArray.filter(d => d.formato_primario === 'Carrossel').length\n  };\n\n  const aviso = trilhaArray.length < 15\n    ? `\\n\\nâš ï¸ Trilha incompleta! ${trilhaArray.length}/15 dias.`\n    : '';\n\n  return {\n    json: {\n      trilha_texto: trilhaFormatada + aviso,\n      trilha_json: JSON.stringify(trilhaArray, null, 2),\n      trilha_completa_json: JSON.stringify(parsed, null, 2),\n      dias_reels_json: JSON.stringify(diasComReels, null, 2),\n      expert_id: parsed.expert_id || 'unknown',\n      expert_name: parsed.expert_name || 'Unknown',\n      total_dias: stats.total_dias,\n      total_reels: stats.total_reels,\n      stats: stats,\n      data_geracao: new Date().toISOString(),\n      parsing_status: 'success',\n      parsing_warning: trilhaArray.length < 15 ? 'trilha_incompleta' : null\n    }\n  };\n}"
      },
      "id": "parse-parte-2",
      "name": "Parse Trilha - Parte 2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "const parte1Input = $('Parse Trilha - Parte 1').first();\nconst parte2Input = $('Parse Trilha - Parte 2').first();\n\nconsole.log('ðŸ“¦ Juntando partes da trilha editorial...');\n\nif (!parte1Input || !parte2Input) {\n  throw new Error('âŒ Uma das partes estÃ¡ faltando');\n}\n\nconst parte1 = parte1Input.json;\nconst parte2 = parte2Input.json;\n\nlet trilhaParte1 = JSON.parse(parte1.trilha_json);\nlet trilhaParte2 = JSON.parse(parte2.trilha_json);\n\nconst trilhaCompleta = [...trilhaParte1, ...trilhaParte2];\ntrilhaCompleta.sort((a, b) => a.dia - b.dia);\n\nconsole.log(`ðŸ“… Trilha completa: ${trilhaCompleta.length} dias`);\n\nconst totalReels = trilhaCompleta.filter(d => d.formato_primario === 'Reel').length;\nconst totalStories = trilhaCompleta.filter(d => d.formato_primario === 'Story').length;\nconst totalCarrosseis = trilhaCompleta.filter(d => d.formato_primario === 'Carrossel').length;\n\nconst statsCombinadas = {\n  total_dias: trilhaCompleta.length,\n  total_reels: totalReels,\n  total_stories: totalStories,\n  total_carrosseis: totalCarrosseis,\n  por_fase: {\n    awareness: trilhaCompleta.filter(d => d.fase === 'Awareness').length,\n    educacao: trilhaCompleta.filter(d => d.fase === 'EducaÃ§Ã£o').length,\n    diferenciacao: trilhaCompleta.filter(d => d.fase === 'DiferenciaÃ§Ã£o').length,\n    conversao: trilhaCompleta.filter(d => d.fase === 'ConversÃ£o').length\n  }\n};\n\nconst trilhaFormatada = trilhaCompleta.map(dia =>\n  `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n` +\n  `ðŸ“… DIA ${dia.dia} | ${dia.dia_semana} ${dia.data_sugerida}\\n` +\n  `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n` +\n  `ðŸŽ¯ FASE: ${dia.fase}\\n` +\n  `ðŸ“Œ PILAR: ${dia.pilar}\\n` +\n  `ðŸŒ¡ï¸ TEMPERATURA: ${dia.temperatura_lead}\\n\\n` +\n  `ðŸ“ TEMA:\\n${dia.tema}\\n\\n` +\n  `ðŸ” Ã‚NGULO:\\n${dia.angulo}\\n\\n` +\n  `ðŸŽ¬ FORMATO: ${dia.formato_primario}${dia.duracao_estimada ? ` (${dia.duracao_estimada})` : ''}\\n\\n` +\n  `ðŸŽª GATILHO: ${dia.gatilho_mental}\\n` +\n  `ðŸŽ¯ OBJETIVO: ${dia.objetivo}\\n` +\n  `ðŸ“Š MÃ‰TRICA: ${dia.metrica_sucesso}\\n\\n` +\n  `ðŸ’¡ PONTOS:\\n${(dia.pontos_chave || []).map((p, i) => `  ${i+1}. ${p}`).join('\\n')}\\n\\n` +\n  `ðŸª HOOK: \"${dia.hook_sugerido || 'N/A'}\"\\n` +\n  `ðŸ“£ CTA (${dia.cta_tipo}): ${dia.cta_texto || 'N/A'}\\n` +\n  (dia.objecao_abordada ? `ðŸš§ OBJEÃ‡ÃƒO: ${dia.objecao_abordada}\\n` : '')\n).join('\\n\\n');\n\nconst statsFormatadas =\n  `ðŸ“Š ESTATÃSTICAS DA TRILHA COMPLETA (30 DIAS)\\n\\n` +\n  `ðŸ“… Total: ${statsCombinadas.total_dias} dias\\n` +\n  `ðŸŽ¬ Reels: ${statsCombinadas.total_reels} | Stories: ${statsCombinadas.total_stories} | CarrossÃ©is: ${statsCombinadas.total_carrosseis}\\n\\n` +\n  `ðŸŒ¡ï¸ POR FASE:\\n` +\n  `  â€¢ Awareness: ${statsCombinadas.por_fase.awareness}\\n` +\n  `  â€¢ EducaÃ§Ã£o: ${statsCombinadas.por_fase.educacao}\\n` +\n  `  â€¢ DiferenciaÃ§Ã£o: ${statsCombinadas.por_fase.diferenciacao}\\n` +\n  `  â€¢ ConversÃ£o: ${statsCombinadas.por_fase.conversao}\\n\\n` +\n  `âœ… Parte 1: ${trilhaParte1.length} dias\\n` +\n  `âœ… Parte 2: ${trilhaParte2.length} dias`;\n\nconst calendarioSimples = trilhaCompleta.map(dia =>\n  `${dia.data_sugerida} (${dia.dia_semana}) | ${dia.formato_primario} | ${dia.tema}`\n).join('\\n');\n\nconst diasComReels = trilhaCompleta.filter(d => d.formato_primario === 'Reel');\n\nconst aviso = trilhaCompleta.length < 30\n  ? `\\n\\nâš ï¸ Trilha incompleta! ${trilhaCompleta.length}/30 dias.`\n  : '\\n\\nâœ… Trilha completa com 30 dias!';\n\nconsole.log('âœ… TRILHA COMPLETA MONTADA!');\n\nreturn {\n  json: {\n    trilha_texto: trilhaFormatada + aviso,\n    calendario_texto: calendarioSimples,\n    stats_texto: statsFormatadas + aviso,\n    trilha_json: JSON.stringify(trilhaCompleta, null, 2),\n    dias_reels_json: JSON.stringify(diasComReels, null, 2),\n    expert_id: parte1.expert_id,\n    expert_name: parte1.expert_name,\n    total_dias: statsCombinadas.total_dias,\n    total_reels: statsCombinadas.total_reels,\n    stats: statsCombinadas,\n    data_geracao: new Date().toISOString(),\n    parsing_status: trilhaCompleta.length === 30 ? 'success' : 'partial',\n    parte1_dias: trilhaParte1.length,\n    parte2_dias: trilhaParte2.length\n  }\n};"
      },
      "id": "juntar-partes",
      "name": "Juntar Partes (30 dias)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        940,
        300
      ]
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Agente Parte 1 (Dias 1-15)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Agente Parte 2 (Dias 16-30)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Parte 1 (Dias 1-15)": {
      "main": [
        [
          {
            "node": "Parse Trilha - Parte 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Parte 2 (Dias 16-30)": {
      "main": [
        [
          {
            "node": "Parse Trilha - Parte 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Trilha - Parte 1": {
      "main": [
        [
          {
            "node": "Juntar Partes (30 dias)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Trilha - Parte 2": {
      "main": [
        [
          {
            "node": "Juntar Partes (30 dias)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-11-25T01:30:00.000Z",
  "versionId": "1"
}
