{
  "name": "Facebook Ads Daily Report - CORRIGIDO",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "id": "0ed78a6e-007a-43bc-a1b2-69488dc3f939",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -5856,
        -800
      ],
      "name": "Schedule Trigger",
      "typeVersion": 1.2,
      "retryOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "000b3175-c71c-4ba3-81e1-ec2194a12e35",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -5200,
        -800
      ],
      "name": "Split Out13",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "83342eb2-eb89-4425-8574-4d70e2d95fc0",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -4304,
        -800
      ],
      "name": "Split Out14",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "97b17d8b-4680-47de-b23e-1b096b4149a2",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -3648,
        -512
      ],
      "name": "Split Out15",
      "typeVersion": 1
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3200,
        -496
      ],
      "id": "1f782079-b196-442e-a722-39a58eb96ac8",
      "name": "Wait2",
      "webhookId": "627a9f05-6a54-4197-a97f-dffd8c184f73"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4080,
        -496
      ],
      "id": "83fc743a-b09a-4e4a-b4f1-29fffbd8dec1",
      "name": "If14"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3408,
        -800
      ],
      "id": "a423f0fe-6290-414b-bc37-a1041f65d974",
      "name": "If15"
    },
    {
      "parameters": {
        "content": "## Daily Facebook Ads Report - CORRIGIDO",
        "height": 680,
        "width": 5764
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5968,
        -992
      ],
      "typeVersion": 1,
      "id": "8aa5becb-8928-4644-bff8-b44edffd5e8e",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "me",
        "edge": "adaccounts",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id"
              },
              {
                "name": "name"
              },
              {
                "name": "account_status"
              }
            ]
          }
        }
      },
      "id": "a1dfc08e-5cdf-465d-885e-2452bb08dc68",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -5456,
        -512
      ],
      "name": "Get FB Ad Accounts2",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{ $json.id }}",
        "edge": "campaigns",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,account_name"
              }
            ]
          }
        }
      },
      "id": "12ed2f18-4062-4983-a421-f201905b660f",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4512,
        -512
      ],
      "name": "Get Ad Campaigns2",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "adsets",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,budget,currency"
              }
            ]
          }
        }
      },
      "id": "9f8a75b5-bd2d-4625-abab-513bc702c0f0",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -3856,
        -800
      ],
      "name": "Get FB Ad Sets2",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "ads",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,creative{video_id,image_url,object_story_spec},insights.date_preset(yesterday){ctr,cpm,cpc,spend,actions,action_values,cost_per_action_type,impressions,clicks},campaign{name},adset{name}"
              }
            ]
          }
        }
      },
      "id": "9e1e569b-601d-4d84-8ec0-f7a8aa655f7d",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -2960,
        -800
      ],
      "name": "Get FB Ad Contents2",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_594452103743956",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5b9bd618-c83f-4f71-a9d0-14236e2e9af4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] Renata Vieira"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98e54e9e-1800-4810-882e-4ae6b4454a86",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_467656524158999",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Dra Gabriela Rossmam "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5bbcbe29-f3a4-45a4-96ae-bc0117041c16",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_1242910680913498",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] LAPPE FINANCE"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "712e6279-42f6-4725-97ca-fe25cdd20dca",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_903049021624083",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] ANDRÃ‰ ROSA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -4976,
        -688
      ],
      "id": "090fd3f5-5805-422d-b9de-a5012967b518",
      "name": "Switch3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1334eb7a-1d63-4710-821d-af01f6ac6824",
              "name": "account_name",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4752,
        -800
      ],
      "id": "1624b5c8-8d57-4be3-89bd-fa2a5ec11ea2",
      "name": "Add Account Name2"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nitems.forEach(item => {\n  const insights = item.json.insights?.data?.[0];\n  console.log('===== DEBUG AD =====');\n  console.log('Ad ID:', item.json.id);\n  console.log('Ad Name:', item.json.name);\n  console.log('date_start:', insights?.date_start);\n  console.log('date_stop:', insights?.date_stop);\n  console.log('====================');\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2736,
        -512
      ],
      "id": "6d4830b6-1765-404a-b3c8-713c43a5dacf",
      "name": "Code in JavaScript11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "86d803d1-ea76-4821-95bc-5d067020578a",
              "leftValue": "={{ $json.insights }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2320,
        -528
      ],
      "id": "e28ba0a7-87d7-4ad7-a38e-a87149b722c0",
      "name": "Filtrar Ativos1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "119650e0-fb37-48e1-bb87-efd4cdd29434",
              "leftValue": "={{ $json.creative.object_story_spec.video_data.video_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2064,
        -800
      ],
      "id": "2dbdd2c5-c32e-45b1-b2f0-1f61451f4b49",
      "name": "Tem VÃ­deo?1"
    },
    {
      "parameters": {
        "jsCode": "// Processar TODOS os itens e formatar para Airtable\nconst items = $input.all();\n\nreturn items.map((item, index) => {\n  const data = item.json;\n  \n  // Usar date_start do insight como data do ad\n  const dataAd = data.insights?.data?.[0]?.date_start || new Date().toISOString().split('T')[0];\n  \n  // BUSCAR O ACCOUNT NAME DO NÃ“ \"Add Account Name2\"\n  const accountName = $('Add Account Name2').first().json.account_name;\n  \n  return {\n    json: {\n      \"Ad ID\": data.id,\n      \"Ad Name\": data.name,\n      \"Campaign Name\": data.campaign?.name || 'N/A',\n      \"AdSet Name\": data.adset?.name || 'N/A',\n      \"Active Status\": data.effective_status,\n      \"Impressions\": data.insights?.data?.[0]?.impressions || '0',\n      \"Clicks\": data.insights?.data?.[0]?.clicks || '0',\n      \"Spend\": data.insights?.data?.[0]?.spend || '0',\n      \"CPC\": data.insights?.data?.[0]?.cpc || '0',\n      \"CPM\": data.insights?.data?.[0]?.cpm || '0',\n      \"Conversions\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Conversion Value\": data.insights?.data?.[0]?.action_values?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Video ID\": data.creative?.object_story_spec?.video_data?.video_id || 'N/A',\n      \"Conversas Iniciadas\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Custo por Conversa\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Primeira Resposta (vocÃª respondeu)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Custo por Mensagem Profundidade 2\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Custo por Primeira Resposta\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Date\": dataAd,\n      \"Account Name\": accountName  // â† Usando o valor do Add Account Name2\n    },\n    pairedItem: { item: index }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1840,
        -528
      ],
      "id": "25db2c54-f300-4339-a7af-65011ca74873",
      "name": "Formatar Campos Facebook1"
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance",
          "cachedResultUrl": "https://airtable.com/appSPnZynb2jGYGRv/tblq56TF4aT0Zz1sN"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Best Ads?": false,
            "Ad Name": "={{ $json[\"Ad Name\"] }}",
            "Spend": "={{ $json.Spend }}",
            "Conversions": "={{ $json.Conversions }}",
            "Conversion Value": "={{ $json[\"Conversion Value\"] }}",
            "CPC": "={{ $json.CPC }}",
            "CPM": "={{ $json.CPM }}",
            "Video ID": "={{ $json[\"Video ID\"] }}",
            "Ad ID": "={{ $json[\"Ad ID\"] }}",
            "Campaign Name": "={{ $json[\"Campaign Name\"] }}",
            "AdSet Name": "={{ $json[\"AdSet Name\"] }}",
            "Active Status": "={{ $json[\"Active Status\"] }}",
            "Impressions": "={{ $json.Impressions }}",
            "Clicks": "={{ $json.Clicks }}",
            "Custo por Conversa": "={{ $json['Custo por Conversa'] }}",
            "Conversas Iniciadas": "={{ $json['Conversas Iniciadas'] }}",
            "Custo Primeira Resposta": "={{ $json['Custo por Primeira Resposta'] }}",
            "Custo Mensagem Depth 2": "={{ $json['Custo por Mensagem Profundidade 2'] }}",
            "Primeira Resposta": "={{ $json['Primeira Resposta (vocÃª respondeu)'] }}",
            "Mensagens Depth 2": "={{ $json['Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)'] }}",
            "Account Name": "={{ $json['Account Name'] }}",
            "Date": "={{ $json.Date }}"
          },
          "matchingColumns": [
            "Ad ID",
            "Date",
            "Video ID"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Ad ID",
              "displayName": "Ad ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Best Ads?",
              "displayName": "Best Ads?",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video Script",
              "displayName": "Video Script",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video ID",
              "displayName": "Video ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Active Status",
              "displayName": "Active Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "ACTIVE",
                  "value": "ACTIVE"
                },
                {
                  "name": "PAUSED",
                  "value": "PAUSED"
                },
                {
                  "name": "DELETED",
                  "value": "DELETED"
                },
                {
                  "name": "ARCHIVED",
                  "value": "ARCHIVED"
                },
                {
                  "name": "IN_PROCESS",
                  "value": "IN_PROCESS"
                },
                {
                  "name": "WITH_ISSUES",
                  "value": "WITH_ISSUES"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Impressions",
              "displayName": "Impressions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clicks",
              "displayName": "Clicks",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Spend",
              "displayName": "Spend",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversas Iniciadas",
              "displayName": "Conversas Iniciadas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Mensagens Depth 2",
              "displayName": "Mensagens Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Primeira Resposta",
              "displayName": "Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo por Conversa",
              "displayName": "Custo por Conversa",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Mensagem Depth 2",
              "displayName": "Custo Mensagem Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Primeira Resposta",
              "displayName": "Custo Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversions",
              "displayName": "Conversions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversion Value",
              "displayName": "Conversion Value",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPC",
              "displayName": "CPC",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPM",
              "displayName": "CPM",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "ROAS",
              "displayName": "ROAS",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Engagement Rate [progress]",
              "displayName": "Engagement Rate [progress]",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Last Updated",
              "displayName": "Last Updated",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Ad Name",
              "displayName": "Ad Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Account Name",
              "displayName": "Account Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Campaign Name",
              "displayName": "Campaign Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "AdSet Name",
              "displayName": "AdSet Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Associate to New Product",
              "displayName": "Associate to New Product",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Projects",
              "displayName": "Projects",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "id": "0f05ce2c-1cb3-4453-ad18-42576dad8ea9",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -1616,
        -800
      ],
      "name": "Salvar no Airtable1",
      "typeVersion": 2.1,
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "=AND(\n  {Date} = DATEADD(TODAY(), -1, 'days'),\n  {Active Status} = 'ACTIVE'\n)",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1408,
        -528
      ],
      "id": "3218194c-f752-42e6-90c9-af28c89ac76c",
      "name": "Buscar Dados PerÃ­odo1",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente\nconst today = new Date();\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\n\nconst startDate = yesterday.toISOString().split('T')[0];\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -928,
        -512
      ],
      "id": "497b4b15-b41d-4248-8f02-8dcf70bc425c",
      "name": "Agregar Dados1"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO DIÃRIO\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -720,
        -800
      ],
      "id": "cc4b1a16-41d7-47b2-975e-e448063800a8",
      "name": "Formatar Mensagem1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "b69d6aab-cdac-4c89-8b6c-1c30c180374a",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -2512,
        -800
      ],
      "name": "Split Out2",
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1168,
        -800
      ],
      "id": "7a06ee6d-4b69-41ab-a3e3-ee08388a914f",
      "name": "Code in JavaScript13"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -496,
        -512
      ],
      "id": "9f6b88b4-15e2-46d4-9d14-0425f5710acf",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "77146556-50a3-4ce9-b498-9af71ca8b674",
      "name": "Send WhatsApp Report2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        -800
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1
              ],
              "triggerAtHour": 8
            }
          ]
        }
      },
      "id": "b4a548e7-354d-4e69-a88f-fb590c37fbc8",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -5856,
        -2256
      ],
      "name": "Schedule Trigger3",
      "typeVersion": 1.2,
      "retryOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "70ee7da6-1529-4196-b4ef-cb0d29343129",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -5408,
        -2256
      ],
      "name": "Split Out16",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "62a16d79-6127-4317-8a74-c483dac62286",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -4512,
        -2256
      ],
      "name": "Split Out17",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "594bbf71-6390-41b9-9c43-e64664631ece",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -3856,
        -1968
      ],
      "name": "Split Out18",
      "typeVersion": 1
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3408,
        -1952
      ],
      "id": "9f9f3084-2212-4a0b-933c-f477812ead04",
      "name": "Wait3",
      "webhookId": "627a9f05-6a54-4197-a97f-dffd8c184f73"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4288,
        -1952
      ],
      "id": "641b223a-e80e-45d0-a7ff-ad65faba530c",
      "name": "If16"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3616,
        -2256
      ],
      "id": "555f2f81-aba1-4d13-9a8c-593caf073d65",
      "name": "If17"
    },
    {
      "parameters": {
        "content": "## 7 Days Facebook Ads Report - CORRIGIDO",
        "height": 680,
        "width": 5764
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5968,
        -2448
      ],
      "typeVersion": 1,
      "id": "0d625349-e22e-4ff0-aed3-fb2b3007dc3d",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "me",
        "edge": "adaccounts",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id"
              },
              {
                "name": "name"
              },
              {
                "name": "account_status"
              }
            ]
          }
        }
      },
      "id": "2c36835c-0f05-4969-a320-02e35561dfec",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -5632,
        -1968
      ],
      "name": "Get FB Ad Accounts3",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{ $json.id }}",
        "edge": "campaigns",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,account_name"
              }
            ]
          }
        }
      },
      "id": "3c201acd-a0e1-481e-9b12-881a2dcce4e2",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4720,
        -1968
      ],
      "name": "Get Ad Campaigns3",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "adsets",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,budget,currency"
              }
            ]
          }
        }
      },
      "id": "193fa971-67d9-4b15-a925-f9061f0c7f11",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4064,
        -2256
      ],
      "name": "Get FB Ad Sets3",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "ads",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,creative{video_id,image_url,object_story_spec},insights.date_preset(last_7d){ctr,cpm,cpc,spend,actions,action_values,cost_per_action_type,impressions,clicks},campaign{name},adset{name}"
              }
            ]
          }
        }
      },
      "id": "cc21f05e-5e3a-4b72-a840-f5ff87aac5fc",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -3168,
        -2256
      ],
      "name": "Get FB Ad Contents3",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_594452103743956",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5b9bd618-c83f-4f71-a9d0-14236e2e9af4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] Renata Vieira"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98e54e9e-1800-4810-882e-4ae6b4454a86",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_467656524158999",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Dra Gabriela Rossmam "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5bbcbe29-f3a4-45a4-96ae-bc0117041c16",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_1242910680913498",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] LAPPE FINANCE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -5184,
        -2144
      ],
      "id": "073e8307-8b84-4250-ae16-4136d84ad576",
      "name": "Switch4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1334eb7a-1d63-4710-821d-af01f6ac6824",
              "name": "account_name",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4960,
        -2256
      ],
      "id": "bf543d27-cd97-4c16-b470-e0df2b6cb085",
      "name": "Add Account Name3"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nitems.forEach(item => {\n  const insights = item.json.insights?.data?.[0];\n  console.log('===== DEBUG AD =====');\n  console.log('Ad ID:', item.json.id);\n  console.log('Ad Name:', item.json.name);\n  console.log('date_start:', insights?.date_start);\n  console.log('date_stop:', insights?.date_stop);\n  console.log('====================');\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2944,
        -1968
      ],
      "id": "ef81ca26-2d95-414e-a470-1dbac7e4ea80",
      "name": "Code in JavaScript14"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "86d803d1-ea76-4821-95bc-5d067020578a",
              "leftValue": "={{ $json.insights }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2528,
        -1984
      ],
      "id": "617b8b63-9a3f-4e71-9d30-f0fa708da8b5",
      "name": "Filtrar Ativos2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "119650e0-fb37-48e1-bb87-efd4cdd29434",
              "leftValue": "={{ $json.creative.object_story_spec.video_data.video_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2272,
        -2256
      ],
      "id": "af3da1cd-f2fb-4cb2-89d3-db7a4e4c60c5",
      "name": "Tem VÃ­deo?2"
    },
    {
      "parameters": {
        "jsCode": "// Processar TODOS os itens e formatar para Airtable\nconst items = $input.all();\n\nreturn items.map((item, index) => {\n  const data = item.json;\n  \n  // Usar date_start do insight como data do ad\n  const dataAd = data.insights?.data?.[0]?.date_start || new Date().toISOString().split('T')[0];\n  \n  return {\n    json: {\n      \"Ad ID\": data.id,\n      \"Ad Name\": data.name,\n      \"Campaign Name\": data.campaign?.name || 'N/A',\n      \"AdSet Name\": data.adset?.name || 'N/A',\n      \"Active Status\": data.effective_status,\n      \"Impressions\": data.insights?.data?.[0]?.impressions || '0',\n      \"Clicks\": data.insights?.data?.[0]?.clicks || '0',\n      \"Spend\": data.insights?.data?.[0]?.spend || '0',\n      \"CPC\": data.insights?.data?.[0]?.cpc || '0',\n      \"CPM\": data.insights?.data?.[0]?.cpm || '0',\n      \"Conversions\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Conversion Value\": data.insights?.data?.[0]?.action_values?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Video ID\": data.creative?.object_story_spec?.video_data?.video_id || 'N/A',\n      \"Conversas Iniciadas\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Custo por Conversa\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Primeira Resposta (vocÃª respondeu)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Custo por Mensagem Profundidade 2\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Custo por Primeira Resposta\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Date\": dataAd,\n      \"Account Name\": \"[MOTTIVME] LAPPE FINANCE\"\n    },\n    pairedItem: { item: index }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2048,
        -1984
      ],
      "id": "1a717e1c-4100-4690-9366-a813ff809377",
      "name": "Formatar Campos Facebook2"
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance",
          "cachedResultUrl": "https://airtable.com/appSPnZynb2jGYGRv/tblq56TF4aT0Zz1sN"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Best Ads?": false,
            "Ad Name": "={{ $json[\"Ad Name\"] }}",
            "Spend": "={{ $json.Spend }}",
            "Conversions": "={{ $json.Conversions }}",
            "Conversion Value": "={{ $json[\"Conversion Value\"] }}",
            "CPC": "={{ $json.CPC }}",
            "CPM": "={{ $json.CPM }}",
            "Video ID": "={{ $json[\"Video ID\"] }}",
            "Ad ID": "={{ $json[\"Ad ID\"] }}",
            "Campaign Name": "={{ $json[\"Campaign Name\"] }}",
            "AdSet Name": "={{ $json[\"AdSet Name\"] }}",
            "Active Status": "={{ $json[\"Active Status\"] }}",
            "Impressions": "={{ $json.Impressions }}",
            "Clicks": "={{ $json.Clicks }}",
            "Custo por Conversa": "={{ $json['Custo por Conversa'] }}",
            "Conversas Iniciadas": "={{ $json['Conversas Iniciadas'] }}",
            "Custo Primeira Resposta": "={{ $json['Custo por Primeira Resposta'] }}",
            "Custo Mensagem Depth 2": "={{ $json['Custo por Mensagem Profundidade 2'] }}",
            "Primeira Resposta": "={{ $json['Primeira Resposta (vocÃª respondeu)'] }}",
            "Mensagens Depth 2": "={{ $json['Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)'] }}",
            "Account Name": "={{ $json['Account Name'] }}",
            "Date": "={{ $json.Date }}"
          },
          "matchingColumns": [
            "Ad ID",
            "Date",
            "Video ID"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Ad ID",
              "displayName": "Ad ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Best Ads?",
              "displayName": "Best Ads?",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video Script",
              "displayName": "Video Script",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video ID",
              "displayName": "Video ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Active Status",
              "displayName": "Active Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "ACTIVE",
                  "value": "ACTIVE"
                },
                {
                  "name": "PAUSED",
                  "value": "PAUSED"
                },
                {
                  "name": "DELETED",
                  "value": "DELETED"
                },
                {
                  "name": "ARCHIVED",
                  "value": "ARCHIVED"
                },
                {
                  "name": "IN_PROCESS",
                  "value": "IN_PROCESS"
                },
                {
                  "name": "WITH_ISSUES",
                  "value": "WITH_ISSUES"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Impressions",
              "displayName": "Impressions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clicks",
              "displayName": "Clicks",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Spend",
              "displayName": "Spend",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversas Iniciadas",
              "displayName": "Conversas Iniciadas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Mensagens Depth 2",
              "displayName": "Mensagens Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Primeira Resposta",
              "displayName": "Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo por Conversa",
              "displayName": "Custo por Conversa",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Mensagem Depth 2",
              "displayName": "Custo Mensagem Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Primeira Resposta",
              "displayName": "Custo Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversions",
              "displayName": "Conversions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversion Value",
              "displayName": "Conversion Value",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPC",
              "displayName": "CPC",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPM",
              "displayName": "CPM",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "ROAS",
              "displayName": "ROAS",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Engagement Rate [progress]",
              "displayName": "Engagement Rate [progress]",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Last Updated",
              "displayName": "Last Updated",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Ad Name",
              "displayName": "Ad Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Account Name",
              "displayName": "Account Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Campaign Name",
              "displayName": "Campaign Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "AdSet Name",
              "displayName": "AdSet Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Associate to New Product",
              "displayName": "Associate to New Product",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Projects",
              "displayName": "Projects",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "id": "3172b051-a0ca-4abb-84d4-cee6b978fdbc",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -1824,
        -2256
      ],
      "name": "Salvar no Airtable2",
      "typeVersion": 2.1,
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "=AND(\n  IS_AFTER({Date}, DATEADD(TODAY(), -8, 'days')),\n  IS_BEFORE({Date}, TODAY()),\n  {Active Status} = 'ACTIVE'\n)",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1616,
        -1984
      ],
      "id": "9342278b-144c-475c-af3e-13da578ac259",
      "name": "Buscar Dados PerÃ­odo2",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente - Ãºltimos 7 dias\nconst today = new Date();\nconst sevenDaysAgo = new Date(today);\nsevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\nconst startDate = sevenDaysAgo.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1136,
        -1968
      ],
      "id": "eab2d797-b13c-4c91-945d-8d344a4a656c",
      "name": "Agregar Dados2"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO SEMANAL (ÃšLTIMOS 7 DIAS)\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -928,
        -2256
      ],
      "id": "bb6fa876-b6d7-4ee7-89b9-cc9411289a2f",
      "name": "Formatar Mensagem2"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "c63f5f0b-0560-4d05-943e-0d181feae6aa",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -2720,
        -2256
      ],
      "name": "Split Out3",
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1376,
        -2256
      ],
      "id": "5e940985-3307-4a5c-a083-fb0e870b80b9",
      "name": "Code in JavaScript15"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -1968
      ],
      "id": "423316b5-cddb-4ba0-b0b5-291f494541d0",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7fce75f8-eafb-430a-9d68-ec5d7be1b4e6",
      "name": "Send WhatsApp Report5",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -480,
        -2256
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 10 1 * *"
            }
          ]
        }
      },
      "id": "3462fc0a-d7e1-4b08-9292-c6cf6355b7d6",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -5872,
        -3056
      ],
      "name": "Schedule Trigger4",
      "typeVersion": 1.2,
      "retryOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "d5324543-542b-46e0-a2fa-13e3a00e2344",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -5424,
        -3056
      ],
      "name": "Split Out19",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "50fb768c-985d-44b5-9023-7e3c22ff755d",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -4528,
        -3056
      ],
      "name": "Split Out20",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "b088cbc0-0459-43d5-ae86-851867571a0a",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -3872,
        -2768
      ],
      "name": "Split Out21",
      "typeVersion": 1
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3424,
        -2752
      ],
      "id": "e3ad0070-a91c-40b4-81fb-a67f7568053e",
      "name": "Wait4",
      "webhookId": "627a9f05-6a54-4197-a97f-dffd8c184f73"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4304,
        -2752
      ],
      "id": "a97b368a-7486-4e23-b312-012de63f7a35",
      "name": "If18"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3632,
        -3056
      ],
      "id": "f16cab82-0e0a-46a4-8972-465ffd8f280d",
      "name": "If19"
    },
    {
      "parameters": {
        "content": "## 30 Days Facebook Ads Report - CORRIGIDO",
        "height": 680,
        "width": 5764
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5984,
        -3248
      ],
      "typeVersion": 1,
      "id": "6946cb0d-3e5c-4bba-b018-3c44e56d636c",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "me",
        "edge": "adaccounts",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id"
              },
              {
                "name": "name"
              },
              {
                "name": "account_status"
              }
            ]
          }
        }
      },
      "id": "38ba3d31-5e6a-4201-903a-8e937f1460dd",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -5648,
        -2768
      ],
      "name": "Get FB Ad Accounts4",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{ $json.id }}",
        "edge": "campaigns",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,account_name"
              }
            ]
          }
        }
      },
      "id": "efff687f-13e0-467d-9897-a3563544f5aa",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4736,
        -2768
      ],
      "name": "Get Ad Campaigns4",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "adsets",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,budget,currency"
              }
            ]
          }
        }
      },
      "id": "cbf08bfc-466a-4d92-a9e8-95fcdcdcb30c",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4080,
        -3056
      ],
      "name": "Get FB Ad Sets4",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "ads",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,creative{video_id,image_url,object_story_spec},insights.date_preset(last_30d){ctr,cpm,cpc,spend,actions,action_values,cost_per_action_type,impressions,clicks},campaign{name},adset{name}"
              }
            ]
          }
        }
      },
      "id": "5ff36ee1-9cd6-422f-af14-61383f37c2f7",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -3184,
        -3056
      ],
      "name": "Get FB Ad Contents4",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_594452103743956",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5b9bd618-c83f-4f71-a9d0-14236e2e9af4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] Renata Vieira"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98e54e9e-1800-4810-882e-4ae6b4454a86",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_467656524158999",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Dra Gabriela Rossmam "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5bbcbe29-f3a4-45a4-96ae-bc0117041c16",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_1242910680913498",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] LAPPE FINANCE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -5200,
        -2944
      ],
      "id": "8f50755f-0ec5-4830-9d1a-b99353535cdb",
      "name": "Switch5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1334eb7a-1d63-4710-821d-af01f6ac6824",
              "name": "account_name",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4976,
        -3056
      ],
      "id": "3c0b2d30-c1e0-4c77-96ae-4c9feafccc6d",
      "name": "Add Account Name4"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nitems.forEach(item => {\n  const insights = item.json.insights?.data?.[0];\n  console.log('===== DEBUG AD =====');\n  console.log('Ad ID:', item.json.id);\n  console.log('Ad Name:', item.json.name);\n  console.log('date_start:', insights?.date_start);\n  console.log('date_stop:', insights?.date_stop);\n  console.log('====================');\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2960,
        -2768
      ],
      "id": "78ae595b-eccb-4747-ab28-c90c650558a3",
      "name": "Code in JavaScript16"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "86d803d1-ea76-4821-95bc-5d067020578a",
              "leftValue": "={{ $json.insights }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2544,
        -2784
      ],
      "id": "88f7a742-8f2f-4d42-9d92-a99fa6cfec58",
      "name": "Filtrar Ativos3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "119650e0-fb37-48e1-bb87-efd4cdd29434",
              "leftValue": "={{ $json.creative.object_story_spec.video_data.video_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2288,
        -3056
      ],
      "id": "15ea8eca-5003-4c11-a1f6-c67df662fc9f",
      "name": "Tem VÃ­deo?3"
    },
    {
      "parameters": {
        "jsCode": "// Processar TODOS os itens e formatar para Airtable\nconst items = $input.all();\n\nreturn items.map((item, index) => {\n  const data = item.json;\n  \n  // Usar date_start do insight como data do ad\n  const dataAd = data.insights?.data?.[0]?.date_start || new Date().toISOString().split('T')[0];\n  \n  return {\n    json: {\n      \"Ad ID\": data.id,\n      \"Ad Name\": data.name,\n      \"Campaign Name\": data.campaign?.name || 'N/A',\n      \"AdSet Name\": data.adset?.name || 'N/A',\n      \"Active Status\": data.effective_status,\n      \"Impressions\": data.insights?.data?.[0]?.impressions || '0',\n      \"Clicks\": data.insights?.data?.[0]?.clicks || '0',\n      \"Spend\": data.insights?.data?.[0]?.spend || '0',\n      \"CPC\": data.insights?.data?.[0]?.cpc || '0',\n      \"CPM\": data.insights?.data?.[0]?.cpm || '0',\n      \"Conversions\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Conversion Value\": data.insights?.data?.[0]?.action_values?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Video ID\": data.creative?.object_story_spec?.video_data?.video_id || 'N/A',\n      \"Conversas Iniciadas\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Custo por Conversa\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Primeira Resposta (vocÃª respondeu)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Custo por Mensagem Profundidade 2\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Custo por Primeira Resposta\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Date\": dataAd,\n      \"Account Name\": \"[MOTTIVME] LAPPE FINANCE\"\n    },\n    pairedItem: { item: index }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2064,
        -2784
      ],
      "id": "4706643a-cda5-4bd7-9430-199a16656640",
      "name": "Formatar Campos Facebook3"
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance",
          "cachedResultUrl": "https://airtable.com/appSPnZynb2jGYGRv/tblq56TF4aT0Zz1sN"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Best Ads?": false,
            "Ad Name": "={{ $json[\"Ad Name\"] }}",
            "Spend": "={{ $json.Spend }}",
            "Conversions": "={{ $json.Conversions }}",
            "Conversion Value": "={{ $json[\"Conversion Value\"] }}",
            "CPC": "={{ $json.CPC }}",
            "CPM": "={{ $json.CPM }}",
            "Video ID": "={{ $json[\"Video ID\"] }}",
            "Ad ID": "={{ $json[\"Ad ID\"] }}",
            "Campaign Name": "={{ $json[\"Campaign Name\"] }}",
            "AdSet Name": "={{ $json[\"AdSet Name\"] }}",
            "Active Status": "={{ $json[\"Active Status\"] }}",
            "Impressions": "={{ $json.Impressions }}",
            "Clicks": "={{ $json.Clicks }}",
            "Custo por Conversa": "={{ $json['Custo por Conversa'] }}",
            "Conversas Iniciadas": "={{ $json['Conversas Iniciadas'] }}",
            "Custo Primeira Resposta": "={{ $json['Custo por Primeira Resposta'] }}",
            "Custo Mensagem Depth 2": "={{ $json['Custo por Mensagem Profundidade 2'] }}",
            "Primeira Resposta": "={{ $json['Primeira Resposta (vocÃª respondeu)'] }}",
            "Mensagens Depth 2": "={{ $json['Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)'] }}",
            "Account Name": "={{ $json['Account Name'] }}",
            "Date": "={{ $json.Date }}"
          },
          "matchingColumns": [
            "Ad ID",
            "Date",
            "Video ID"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Ad ID",
              "displayName": "Ad ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Best Ads?",
              "displayName": "Best Ads?",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video Script",
              "displayName": "Video Script",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video ID",
              "displayName": "Video ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Active Status",
              "displayName": "Active Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "ACTIVE",
                  "value": "ACTIVE"
                },
                {
                  "name": "PAUSED",
                  "value": "PAUSED"
                },
                {
                  "name": "DELETED",
                  "value": "DELETED"
                },
                {
                  "name": "ARCHIVED",
                  "value": "ARCHIVED"
                },
                {
                  "name": "IN_PROCESS",
                  "value": "IN_PROCESS"
                },
                {
                  "name": "WITH_ISSUES",
                  "value": "WITH_ISSUES"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Impressions",
              "displayName": "Impressions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clicks",
              "displayName": "Clicks",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Spend",
              "displayName": "Spend",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversas Iniciadas",
              "displayName": "Conversas Iniciadas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Mensagens Depth 2",
              "displayName": "Mensagens Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Primeira Resposta",
              "displayName": "Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo por Conversa",
              "displayName": "Custo por Conversa",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Mensagem Depth 2",
              "displayName": "Custo Mensagem Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Primeira Resposta",
              "displayName": "Custo Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversions",
              "displayName": "Conversions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversion Value",
              "displayName": "Conversion Value",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPC",
              "displayName": "CPC",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPM",
              "displayName": "CPM",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "ROAS",
              "displayName": "ROAS",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Engagement Rate [progress]",
              "displayName": "Engagement Rate [progress]",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Last Updated",
              "displayName": "Last Updated",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Ad Name",
              "displayName": "Ad Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Account Name",
              "displayName": "Account Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Campaign Name",
              "displayName": "Campaign Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "AdSet Name",
              "displayName": "AdSet Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Associate to New Product",
              "displayName": "Associate to New Product",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Projects",
              "displayName": "Projects",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "id": "977561f4-2859-4e1d-8b0a-32e915f52a0a",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -1840,
        -3056
      ],
      "name": "Salvar no Airtable3",
      "typeVersion": 2.1,
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "=AND(\n  IS_AFTER({Date}, DATEADD(TODAY(), -31, 'days')),\n  IS_BEFORE({Date}, TODAY()),\n  {Active Status} = 'ACTIVE'\n)",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1632,
        -2784
      ],
      "id": "8006efcf-fde1-4303-b206-b5d657c13713",
      "name": "Buscar Dados PerÃ­odo3",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente - Ãºltimos 30 dias\nconst today = new Date();\nconst thirtyDaysAgo = new Date(today);\nthirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\nconst startDate = thirtyDaysAgo.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1152,
        -2768
      ],
      "id": "57ea124b-5905-40b4-9e71-a3931b341600",
      "name": "Agregar Dados3"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO MENSAL (ÃšLTIMOS 30 DIAS)\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -944,
        -3056
      ],
      "id": "2dea35ab-080e-45c0-8fb6-65d9e27b606a",
      "name": "Formatar Mensagem3"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "0c21942f-a4d8-4431-a462-eea06c9cdf75",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -2736,
        -3056
      ],
      "name": "Split Out4",
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1392,
        -3056
      ],
      "id": "fc3aad51-3da4-45bf-9247-ddd6b80ad4a1",
      "name": "Code in JavaScript17"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -720,
        -2768
      ],
      "id": "0ed37697-481f-4463-b6ab-4234e7321640",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7216f444-b2e3-4184-a2d3-44318b0dcaa9",
      "name": "Send WhatsApp Report6",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -496,
        -3056
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "daysInterval": 3,
              "triggerAtHour": 8,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "id": "fe4aa9d9-df67-425a-9312-9fc701602cf2",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -5856,
        -1520
      ],
      "name": "Schedule Trigger5",
      "typeVersion": 1.2,
      "retryOnFail": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "58b5d143-e464-4ff4-911d-21e665781e0e",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -5408,
        -1520
      ],
      "name": "Split Out22",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "21fd305f-02e0-4dec-adb6-35415ee2bf30",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -4512,
        -1520
      ],
      "name": "Split Out23",
      "typeVersion": 1
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "d7c3a3be-2a18-457a-95ba-0c80bad8fd1d",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -3856,
        -1232
      ],
      "name": "Split Out24",
      "typeVersion": 1
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -3408,
        -1216
      ],
      "id": "c327505d-5725-4cdb-b34a-3af333d09626",
      "name": "Wait5",
      "webhookId": "627a9f05-6a54-4197-a97f-dffd8c184f73"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4288,
        -1216
      ],
      "id": "dca8e9cb-49fe-4266-948c-a53f9fe4ead6",
      "name": "If20"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3616,
        -1520
      ],
      "id": "bfa13b67-747f-459b-8c21-df375e6c3144",
      "name": "If21"
    },
    {
      "parameters": {
        "content": "## 3 Days Facebook Ads Report - CORRIGIDO",
        "height": 680,
        "width": 5764
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5968,
        -1712
      ],
      "typeVersion": 1,
      "id": "8762d198-6d52-4a72-9757-e962b131eefd",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "graphApiVersion": "v23.0",
        "node": "me",
        "edge": "adaccounts",
        "options": {
          "fields": {
            "field": [
              {
                "name": "id"
              },
              {
                "name": "name"
              },
              {
                "name": "account_status"
              }
            ]
          }
        }
      },
      "id": "59b8b10e-7a50-4b81-9f1f-d4bda3ea5971",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -5632,
        -1232
      ],
      "name": "Get FB Ad Accounts5",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{ $json.id }}",
        "edge": "campaigns",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,account_name"
              }
            ]
          }
        }
      },
      "id": "9e39c66f-159d-48dc-a4d8-77eb00d21f91",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4720,
        -1232
      ],
      "name": "Get Ad Campaigns5",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "adsets",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,budget,currency"
              }
            ]
          }
        }
      },
      "id": "d0a3e531-de54-42af-a2e9-be2a103c1819",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -4064,
        -1520
      ],
      "name": "Get FB Ad Sets5",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "graphApiVersion": "v22.0",
        "node": "={{$json.id}}",
        "edge": "ads",
        "options": {
          "queryParameters": {
            "parameter": [
              {
                "name": "fields",
                "value": "id,name,effective_status,creative{video_id,image_url,object_story_spec},insights.date_preset(last_3d){ctr,cpm,cpc,spend,actions,action_values,cost_per_action_type,impressions,clicks},campaign{name},adset{name}"
              }
            ]
          }
        }
      },
      "id": "bdf13c03-a0f5-4a43-80cd-de2646e8e9eb",
      "type": "n8n-nodes-base.facebookGraphApi",
      "position": [
        -3168,
        -1520
      ],
      "name": "Get FB Ad Contents5",
      "typeVersion": 1,
      "credentials": {
        "facebookGraphApi": {
          "id": "JGQy45kpcae2O5I7",
          "name": "Facebook Graph account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_594452103743956",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5b9bd618-c83f-4f71-a9d0-14236e2e9af4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] Renata Vieira"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98e54e9e-1800-4810-882e-4ae6b4454a86",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_467656524158999",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Dra Gabriela Rossmam "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5bbcbe29-f3a4-45a4-96ae-bc0117041c16",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_1242910680913498",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] LAPPE FINANCE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -5184,
        -1408
      ],
      "id": "c6b49b86-9068-4e7a-9001-e44e9c674a9b",
      "name": "Switch6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1334eb7a-1d63-4710-821d-af01f6ac6824",
              "name": "account_name",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4960,
        -1520
      ],
      "id": "aee64295-b301-48fd-845a-f190a3dfc9b7",
      "name": "Add Account Name5"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nitems.forEach(item => {\n  const insights = item.json.insights?.data?.[0];\n  console.log('===== DEBUG AD =====');\n  console.log('Ad ID:', item.json.id);\n  console.log('Ad Name:', item.json.name);\n  console.log('date_start:', insights?.date_start);\n  console.log('date_stop:', insights?.date_stop);\n  console.log('====================');\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2944,
        -1232
      ],
      "id": "da5a624e-ea20-47c4-ae2a-fe4ac7eeefc9",
      "name": "Code in JavaScript18"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ae9d184-693b-49c1-a971-fc91e1a90522",
              "leftValue": "={{ $json.effective_status }}",
              "rightValue": "ACTIVE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "86d803d1-ea76-4821-95bc-5d067020578a",
              "leftValue": "={{ $json.insights }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2528,
        -1248
      ],
      "id": "ea34498f-493d-4e62-9f78-fab3c867a805",
      "name": "Filtrar Ativos4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "119650e0-fb37-48e1-bb87-efd4cdd29434",
              "leftValue": "={{ $json.creative.object_story_spec.video_data.video_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2272,
        -1520
      ],
      "id": "5d7fae04-7e43-4874-a369-7c3e1cbc14f8",
      "name": "Tem VÃ­deo?4"
    },
    {
      "parameters": {
        "jsCode": "// Processar TODOS os itens e formatar para Airtable\nconst items = $input.all();\n\nreturn items.map((item, index) => {\n  const data = item.json;\n  \n  // Usar date_start do insight como data do ad\n  const dataAd = data.insights?.data?.[0]?.date_start || new Date().toISOString().split('T')[0];\n  \n  return {\n    json: {\n      \"Ad ID\": data.id,\n      \"Ad Name\": data.name,\n      \"Campaign Name\": data.campaign?.name || 'N/A',\n      \"AdSet Name\": data.adset?.name || 'N/A',\n      \"Active Status\": data.effective_status,\n      \"Impressions\": data.insights?.data?.[0]?.impressions || '0',\n      \"Clicks\": data.insights?.data?.[0]?.clicks || '0',\n      \"Spend\": data.insights?.data?.[0]?.spend || '0',\n      \"CPC\": data.insights?.data?.[0]?.cpc || '0',\n      \"CPM\": data.insights?.data?.[0]?.cpm || '0',\n      \"Conversions\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Conversion Value\": data.insights?.data?.[0]?.action_values?.find(a => a.action_type === 'omni_purchase')?.value || '0',\n      \"Video ID\": data.creative?.object_story_spec?.video_data?.video_id || 'N/A',\n      \"Conversas Iniciadas\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Custo por Conversa\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_conversation_started_7d')?.value || '0',\n      \"Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Primeira Resposta (vocÃª respondeu)\": data.insights?.data?.[0]?.actions?.find(a => a.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Custo por Mensagem Profundidade 2\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_user_depth_2_message_send')?.value || '0',\n      \"Custo por Primeira Resposta\": data.insights?.data?.[0]?.cost_per_action_type?.find(c => c.action_type === 'onsite_conversion.messaging_first_reply')?.value || '0',\n      \"Date\": dataAd,\n      \"Account Name\": \"[MOTTIVME] LAPPE FINANCE\"\n    },\n    pairedItem: { item: index }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2048,
        -1248
      ],
      "id": "66ba55f5-f601-4d5d-a0cc-3c3ab27c5c68",
      "name": "Formatar Campos Facebook4"
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance",
          "cachedResultUrl": "https://airtable.com/appSPnZynb2jGYGRv/tblq56TF4aT0Zz1sN"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Best Ads?": false,
            "Ad Name": "={{ $json[\"Ad Name\"] }}",
            "Spend": "={{ $json.Spend }}",
            "Conversions": "={{ $json.Conversions }}",
            "Conversion Value": "={{ $json[\"Conversion Value\"] }}",
            "CPC": "={{ $json.CPC }}",
            "CPM": "={{ $json.CPM }}",
            "Video ID": "={{ $json[\"Video ID\"] }}",
            "Ad ID": "={{ $json[\"Ad ID\"] }}",
            "Campaign Name": "={{ $json[\"Campaign Name\"] }}",
            "AdSet Name": "={{ $json[\"AdSet Name\"] }}",
            "Active Status": "={{ $json[\"Active Status\"] }}",
            "Impressions": "={{ $json.Impressions }}",
            "Clicks": "={{ $json.Clicks }}",
            "Custo por Conversa": "={{ $json['Custo por Conversa'] }}",
            "Conversas Iniciadas": "={{ $json['Conversas Iniciadas'] }}",
            "Custo Primeira Resposta": "={{ $json['Custo por Primeira Resposta'] }}",
            "Custo Mensagem Depth 2": "={{ $json['Custo por Mensagem Profundidade 2'] }}",
            "Primeira Resposta": "={{ $json['Primeira Resposta (vocÃª respondeu)'] }}",
            "Mensagens Depth 2": "={{ $json['Mensagens com Profundidade 2 (usuÃ¡rio enviou 2+ mensagens)'] }}",
            "Account Name": "={{ $json['Account Name'] }}",
            "Date": "={{ $json.Date }}"
          },
          "matchingColumns": [
            "Ad ID",
            "Date",
            "Video ID"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Ad ID",
              "displayName": "Ad ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Best Ads?",
              "displayName": "Best Ads?",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video Script",
              "displayName": "Video Script",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Video ID",
              "displayName": "Video ID",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Active Status",
              "displayName": "Active Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "ACTIVE",
                  "value": "ACTIVE"
                },
                {
                  "name": "PAUSED",
                  "value": "PAUSED"
                },
                {
                  "name": "DELETED",
                  "value": "DELETED"
                },
                {
                  "name": "ARCHIVED",
                  "value": "ARCHIVED"
                },
                {
                  "name": "IN_PROCESS",
                  "value": "IN_PROCESS"
                },
                {
                  "name": "WITH_ISSUES",
                  "value": "WITH_ISSUES"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Impressions",
              "displayName": "Impressions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Clicks",
              "displayName": "Clicks",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Spend",
              "displayName": "Spend",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversas Iniciadas",
              "displayName": "Conversas Iniciadas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Mensagens Depth 2",
              "displayName": "Mensagens Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Primeira Resposta",
              "displayName": "Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo por Conversa",
              "displayName": "Custo por Conversa",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Mensagem Depth 2",
              "displayName": "Custo Mensagem Depth 2",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Custo Primeira Resposta",
              "displayName": "Custo Primeira Resposta",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversions",
              "displayName": "Conversions",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Conversion Value",
              "displayName": "Conversion Value",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPC",
              "displayName": "CPC",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "CPM",
              "displayName": "CPM",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "ROAS",
              "displayName": "ROAS",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Engagement Rate [progress]",
              "displayName": "Engagement Rate [progress]",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Last Updated",
              "displayName": "Last Updated",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Ad Name",
              "displayName": "Ad Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Account Name",
              "displayName": "Account Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Campaign Name",
              "displayName": "Campaign Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "AdSet Name",
              "displayName": "AdSet Name",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Associate to New Product",
              "displayName": "Associate to New Product",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created",
              "displayName": "Created",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Projects",
              "displayName": "Projects",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "id": "2b874b3c-407e-4f6a-b08d-c412be055b54",
      "type": "n8n-nodes-base.airtable",
      "position": [
        -1824,
        -1520
      ],
      "name": "Salvar no Airtable4",
      "typeVersion": 2.1,
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "=AND(\n  IS_AFTER({Date}, DATEADD(TODAY(), -4, 'days')),\n  IS_BEFORE({Date}, TODAY()),\n  {Active Status} = 'ACTIVE'\n)",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        -1616,
        -1248
      ],
      "id": "3feb4550-fccb-4027-b17f-ee9dcb321bb8",
      "name": "Buscar Dados PerÃ­odo4",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente - Ãºltimos 3 dias\nconst today = new Date();\nconst threeDaysAgo = new Date(today);\nthreeDaysAgo.setDate(threeDaysAgo.getDate() - 3);\n\nconst startDate = threeDaysAgo.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1136,
        -1232
      ],
      "id": "e3fb1b9d-dfe9-457d-8302-00f71fad7fcb",
      "name": "Agregar Dados4"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO - ÃšLTIMOS 3 DIAS\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -928,
        -1520
      ],
      "id": "b80c3fab-860c-4726-9621-1615f65f6dca",
      "name": "Formatar Mensagem4"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "90a5ea13-2834-46c3-abf7-48df02d4e53d",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -2720,
        -1520
      ],
      "name": "Split Out5",
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1376,
        -1520
      ],
      "id": "bb0159c8-9d90-4078-b05f-fe28cc95ae1c",
      "name": "Code in JavaScript19"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -1232
      ],
      "id": "8e082f9d-0e07-4600-a16c-25c834c0d5b7",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "11e3adb9-cdc8-491f-887e-dedddf754e89",
      "name": "Send WhatsApp Report7",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -480,
        -1520
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "=act_594452103743956",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5b9bd618-c83f-4f71-a9d0-14236e2e9af4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] Renata Vieira"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "98e54e9e-1800-4810-882e-4ae6b4454a86",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_467656524158999",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Dra Gabriela Rossmam "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5bbcbe29-f3a4-45a4-96ae-bc0117041c16",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "act_1242910680913498",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "[MOTTIVME] LAPPE FINANCE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -496,
        -2832
      ],
      "id": "1aac655f-9110-4b07-bdfb-72b50a1de822",
      "name": "Switch7"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json['Account Name'] }}",
                    "rightValue": "APEX PRO",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "83811f12-2459-4e84-8af4-ff5161494a35"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "APEX"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e379dc58-ffaf-4492-8493-bef9f87ccbd7",
                    "leftValue": "={{ $json['Account Name'] }}",
                    "rightValue": "LAPPE",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "LAPPE"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1280,
        -2528
      ],
      "id": "ca9f3520-f794-4152-9ebb-981deaa11bc2",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente - inÃ­cio do mÃªs atÃ© hoje\nconst today = new Date();\nconst firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);\n\nconst startDate = firstDayOfMonth.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1776,
        -2384
      ],
      "id": "c7d86674-1592-4958-86f8-b79b8dd2a819",
      "name": "Agregar Dados"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO MENSAL (ACUMULADO DO MÃŠS)\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2032,
        -2416
      ],
      "id": "be7833a2-f5dd-401f-8b86-73b24f54f13c",
      "name": "Formatar Mensagem"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        -2416
      ],
      "id": "7aa25773-320b-4c4d-9b63-92db63097130",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2128,
        -2128
      ],
      "id": "531d2f0d-1183-4931-a183-6c1e69b88b01",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "aa0332cc-12a0-4656-99e7-2a199dc0c11e",
      "name": "Send WhatsApp Report",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        -2416
      ]
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "==AND(\n  IS_AFTER({Date}, DATETIME_FORMAT(DATEADD(TODAY(), -DAY(TODAY()) + 1, 'days'), 'YYYY-MM-DD')),\n  IS_BEFORE({Date}, DATEADD(TODAY(), 1, 'days')),\n  SEARCH('LAPPE', {Account Name}) > 0\n)",
        "returnAll": false,
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Account Name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1344,
        -2336
      ],
      "id": "fa95c8a5-c4e3-4105-831b-21486418ab2e",
      "name": "Buscar Dados PerÃ­odo",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "==AND(\n  {Date} >= '2025-11-01',\n  {Date} <= '2025-11-19',\n  SEARCH('LAPPE', {Account Name}) > 0\n)",
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Date"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1392,
        -2128
      ],
      "id": "31ac133d-fb87-42bc-affc-89e4b7a1a041",
      "name": "Buscar Dados PerÃ­odo5",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log('Nenhum dado encontrado');\n  return [];\n}\n\n// LOG: Mostra perÃ­odo dos dados\nconst dates = items.map(i => i.json.Date).filter(d => d).sort();\nconsole.log(`=== DADOS RECEBIDOS ===`);\nconsole.log(`Total de registros: ${items.length}`);\nconsole.log(`Primeira data: ${dates[0]}`);\nconsole.log(`Ãšltima data: ${dates[dates.length - 1]}`);\n\n// Calcula total DIRETO (sem agregar por Ad ID)\nconst totalSpend = items.reduce((sum, item) => sum + (item.json.Spend || 0), 0);\nconsole.log(`Spend TOTAL direto: $${totalSpend.toFixed(2)}`);\n\n// Agrega por Ad ID\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      'Ad ID': adId,\n      'Ad Name': item.json['Ad Name'],\n      'Account Name': item.json['Account Name'],\n      'Campaign Name': item.json['Campaign Name'],\n      'AdSet Name': item.json['AdSet Name'],\n      'Active Status': item.json['Active Status'],\n      'Date': item.json['Date'],\n      Impressions: 0,\n      Clicks: 0,\n      Spend: 0,\n      'Conversas Iniciadas': 0\n    };\n  }\n  \n  aggregated[adId].Impressions += item.json.Impressions || 0;\n  aggregated[adId].Clicks += item.json.Clicks || 0;\n  aggregated[adId].Spend += item.json.Spend || 0;\n  aggregated[adId]['Conversas Iniciadas'] += item.json['Conversas Iniciadas'] || 0;\n}\n\nconsole.log(`AnÃºncios Ãºnicos: ${Object.keys(aggregated).length}`);\n\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1792,
        -2128
      ],
      "id": "1a7b1a8b-e172-44d3-9fa6-fc55d654efe9",
      "name": "Agregar Dados5"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo\nconst today = new Date();\nconst firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);\nconst startDate = firstDayOfMonth.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO MENSAL (ACUMULADO DO MÃŠS)\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2000,
        -2128
      ],
      "id": "7059d60f-d3c8-4fdb-9a73-29e562afb027",
      "name": "Formatar Mensagem5"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Verifica quantas contas diferentes existem\nconst accounts = new Set();\nconst accountStats = {};\n\nfor (const item of items) {\n  const accountName = item.json['Account Name'];\n  accounts.add(accountName);\n  \n  if (!accountStats[accountName]) {\n    accountStats[accountName] = {\n      registros: 0,\n      spend: 0\n    };\n  }\n  \n  accountStats[accountName].registros++;\n  accountStats[accountName].spend += item.json.Spend || 0;\n}\n\nconsole.log('===== DIAGNÃ“STICO =====');\nconsole.log(`Total de registros: ${items.length}`);\nconsole.log(`Contas encontradas: ${accounts.size}`);\nconsole.log('\\nDetalhamento por conta:');\n\nfor (const [account, stats] of Object.entries(accountStats)) {\n  console.log(`\\n${account}:`);\n  console.log(`  Registros: ${stats.registros}`);\n  console.log(`  Spend total: $${stats.spend.toFixed(2)}`);\n}\n\n// Verifica perÃ­odo\nconst dates = items.map(i => i.json.Date).filter(d => d).sort();\nconsole.log(`\\nPerÃ­odo dos dados:`);\nconsole.log(`  Primeira data: ${dates[0]}`);\nconsole.log(`  Ãšltima data: ${dates[dates.length - 1]}`);\n\n// Continua com o processamento normal\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        -2016
      ],
      "id": "32bc65bf-e4f0-436d-b2af-19fcac3c2adf",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "authentication": "airtableOAuth2Api",
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "appSPnZynb2jGYGRv",
          "mode": "list",
          "cachedResultName": "AI VSL Demo"
        },
        "table": {
          "__rl": true,
          "value": "tblq56TF4aT0Zz1sN",
          "mode": "list",
          "cachedResultName": "Ads Performance"
        },
        "filterByFormula": "=AND(\n  IS_AFTER({Date}, DATEADD(TODAY(), -8, 'days')),\n  IS_BEFORE({Date}, TODAY()),\n  {Active Status} = 'ACTIVE'\n)",
        "returnAll": false,
        "options": {},
        "sort": {
          "property": [
            {
              "field": "Account Name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1360,
        -2784
      ],
      "id": "48f6ca63-86ec-4519-ab31-92d9069eebb9",
      "name": "Buscar Dados PerÃ­odo6",
      "credentials": {
        "airtableOAuth2Api": {
          "id": "Ct29AFjU5kldAr8c",
          "name": "vsl ben ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// Calcula as datas dinamicamente - Ãºltimos 7 dias\nconst today = new Date();\nconst sevenDaysAgo = new Date(today);\nsevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\nconst startDate = sevenDaysAgo.toISOString().split('T')[0];\nconst yesterday = new Date(today);\nyesterday.setDate(yesterday.getDate() - 1);\nconst endDate = yesterday.toISOString().split('T')[0];\n\n// Verifica se hÃ¡ dados\nif (!items || items.length === 0) {\n  console.log(`Aviso: Nenhum dado no perÃ­odo ${startDate} a ${endDate}`);\n  \n  // Retorna array vazio ao invÃ©s de dar erro\n  return [];\n}\n\n// Se chegou aqui, hÃ¡ dados - continua com a agregaÃ§Ã£o\nconst aggregated = {};\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  \n  if (!aggregated[adId]) {\n    aggregated[adId] = {\n      ...item.json,\n      totalImpressions: 0,\n      totalClicks: 0,\n      totalSpend: 0\n    };\n  }\n  \n  aggregated[adId].totalImpressions += item.json.Impressions || 0;\n  aggregated[adId].totalClicks += item.json.Clicks || 0;\n  aggregated[adId].totalSpend += item.json.Spend || 0;\n}\n\n// Retorna dados agregados\nreturn Object.values(aggregated).map(data => ({ json: data }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1888,
        -2576
      ],
      "id": "f02f73ae-0c85-4d16-9f3b-abc867d23909",
      "name": "Agregar Dados6"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os itens\nconst items = $input.all();\n\n// VERIFICA SE HÃ DADOS\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      message: \"âš ï¸ Nenhum dado disponÃ­vel para o perÃ­odo selecionado.\\n\\nExecute o workflow completo (desde o inÃ­cio) para buscar dados novos do Facebook Ads.\"\n    }\n  }];\n}\n\n// Extrai os dados do json\nconst data = items.map(item => item.json);\n\n// Pega o nome do cliente (assume que todos sÃ£o da mesma conta)\nconst clientName = data[0]['Account Name'] || 'N/A';\n\n// Calcula o perÃ­odo (pega a menor e maior data)\nconst dates = data.map(item => item.Date).filter(d => d);\nconst startDate = dates.length > 0 ? dates.sort()[0] : 'N/A';\nconst endDate = dates.length > 0 ? dates.sort()[dates.length - 1] : 'N/A';\n\n// Calcula totais\nconst totalSpend = data.reduce((sum, ad) => sum + (parseFloat(ad.Spend) || 0), 0);\nconst totalImpressions = data.reduce((sum, ad) => sum + (parseInt(ad.Impressions) || 0), 0);\nconst totalClicks = data.reduce((sum, ad) => sum + (parseInt(ad.Clicks) || 0), 0);\nconst totalConversas = data.reduce((sum, ad) => sum + (parseInt(ad['Conversas Iniciadas']) || 0), 0);\n\n// Calcula mÃ©tricas\nconst custoMensagem = totalConversas > 0 ? totalSpend / totalConversas : 0;\nconst cpm = totalImpressions > 0 ? (totalSpend / totalImpressions) * 1000 : 0;\nconst ctr = totalImpressions > 0 ? (totalClicks / totalImpressions) * 100 : 0;\nconst taxaConversao = totalClicks > 0 ? (totalConversas / totalClicks) * 100 : 0;\n\n// Ordena por spend (maior para menor) e pega TOP 3\nconst top3 = data\n  .sort((a, b) => (parseFloat(b.Spend) || 0) - (parseFloat(a.Spend) || 0))\n  .slice(0, 3);\n\n// Monta a mensagem\nlet message = `Bom dia, pessoal! Report atualizado das campanhas\\n`;\nmessage += `CLIENTE: ${clientName}\\n\\n`;\nmessage += `ðŸ“… RELATÃ“RIO SEMANAL (ÃšLTIMOS 7 DIAS)\\n`;\nmessage += `ðŸ“… PerÃ­odo: ${startDate} atÃ© ${endDate}\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `Valor Investido: $ ${totalSpend.toFixed(2)}\\n`;\nmessage += `Conversas Iniciadas: ${totalConversas}\\n`;\nmessage += `Custo por mensagem: $ ${custoMensagem.toFixed(2)}\\n`;\nmessage += `CPM: $ ${cpm.toFixed(2)}\\n`;\nmessage += `CTR: ${ctr.toFixed(2)}%\\n`;\nmessage += `Taxa de ConversÃ£o: ${taxaConversao.toFixed(2)}%\\n`;\nmessage += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n`;\nmessage += `TOP 3 ADS POR GASTO:\\n`;\n\n// Adiciona TOP 3\ntop3.forEach((ad, index) => {\n  const adName = ad['Ad Name'] || 'N/A';\n  const adSpend = parseFloat(ad.Spend) || 0;\n  const adConversas = parseInt(ad['Conversas Iniciadas']) || 0;\n  const custoPorConv = adConversas > 0 ? adSpend / adConversas : 0;\n  \n  message += `${index + 1}. ${adName}\\n`;\n  message += `   Gasto: $ ${adSpend.toFixed(2)} | ConversÃµes: ${adConversas} | Custo/Conv: $${custoPorConv.toFixed(2)}\\n`;\n});\n\nreturn [{\n  json: {\n    message: message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2096,
        -2864
      ],
      "id": "3581bcf0-c7eb-412f-b2ed-4da759b6171a",
      "name": "Formatar Mensagem6"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Remove duplicatas baseado no Ad ID\nconst uniqueItems = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  const adId = item.json['Ad ID'];\n  if (!seenIds.has(adId)) {\n    seenIds.add(adId);\n    uniqueItems.push(item);\n  }\n}\n\nreturn uniqueItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1648,
        -2864
      ],
      "id": "9de7dca7-bc55-4d2d-b2b3-0b8700497c2d",
      "name": "Code in JavaScript20"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd867f63-78b2-48ba-afac-143f79fe5589",
              "name": "contactId",
              "value": "zW9CbEIUzNXr9XV8q43V",
              "type": "string"
            },
            {
              "id": "ff292e77-fb5e-4f13-a59a-cf260cf3c6d5",
              "name": "telefone",
              "value": "=",
              "type": "string"
            },
            {
              "id": "f9564cdf-d039-451d-9f4c-271bb2cef359",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2320,
        -2576
      ],
      "id": "c446e85a-5285-4635-bc42-0e31c2778ff8",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://services.leadconnectorhq.com/conversations/messages",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer pit-fe627027-b9cb-4ea3-aaa4-149459e66a03"
            },
            {
              "name": "Version",
              "value": "2021-04-15"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "SMS"
            },
            {
              "name": "contactId",
              "value": "={{ $json.contactId }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "phone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b6d2f82e-0be9-4cc5-a550-534d7a565f51",
      "name": "Send WhatsApp Report8",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2544,
        -2864
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get FB Ad Accounts2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out13": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out14": {
      "main": [
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out15": {
      "main": [
        [
          {
            "node": "If15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Get FB Ad Contents2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "Get FB Ad Sets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If15": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Accounts2": {
      "main": [
        [
          {
            "node": "Split Out13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Campaigns2": {
      "main": [
        [
          {
            "node": "Split Out14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Sets2": {
      "main": [
        [
          {
            "node": "Split Out15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Contents2": {
      "main": [
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Add Account Name2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Account Name2": {
      "main": [
        [
          {
            "node": "Get Ad Campaigns2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar Ativos1": {
      "main": [
        [
          {
            "node": "Tem VÃ­deo?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tem VÃ­deo?1": {
      "main": [
        [
          {
            "node": "Formatar Campos Facebook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Campos Facebook1": {
      "main": [
        [
          {
            "node": "Salvar no Airtable1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salvar no Airtable1": {
      "main": [
        [
          {
            "node": "Buscar Dados PerÃ­odo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo1": {
      "main": [
        [
          {
            "node": "Code in JavaScript13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados1": {
      "main": [
        [
          {
            "node": "Formatar Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem1": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Filtrar Ativos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript13": {
      "main": [
        [
          {
            "node": "Agregar Dados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger3": {
      "main": [
        [
          {
            "node": "Get FB Ad Accounts3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out16": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out17": {
      "main": [
        [
          {
            "node": "If16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out18": {
      "main": [
        [
          {
            "node": "If17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Get FB Ad Contents3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If16": {
      "main": [
        [
          {
            "node": "Get FB Ad Sets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If17": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Accounts3": {
      "main": [
        [
          {
            "node": "Split Out16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Campaigns3": {
      "main": [
        [
          {
            "node": "Split Out17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Sets3": {
      "main": [
        [
          {
            "node": "Split Out18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Contents3": {
      "main": [
        [
          {
            "node": "Code in JavaScript14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Add Account Name3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Account Name3": {
      "main": [
        [
          {
            "node": "Get Ad Campaigns3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript14": {
      "main": [
        [
          {
            "node": "Split Out3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar Ativos2": {
      "main": [
        [
          {
            "node": "Tem VÃ­deo?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tem VÃ­deo?2": {
      "main": [
        [
          {
            "node": "Formatar Campos Facebook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Campos Facebook2": {
      "main": [
        [
          {
            "node": "Salvar no Airtable2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salvar no Airtable2": {
      "main": [
        [
          {
            "node": "Buscar Dados PerÃ­odo2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo2": {
      "main": [
        [
          {
            "node": "Code in JavaScript15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados2": {
      "main": [
        [
          {
            "node": "Formatar Mensagem2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem2": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out3": {
      "main": [
        [
          {
            "node": "Filtrar Ativos2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript15": {
      "main": [
        [
          {
            "node": "Agregar Dados2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger4": {
      "main": [
        [
          {
            "node": "Get FB Ad Accounts4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out19": {
      "main": [
        [
          {
            "node": "Switch5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out20": {
      "main": [
        [
          {
            "node": "If18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out21": {
      "main": [
        [
          {
            "node": "If19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait4": {
      "main": [
        [
          {
            "node": "Get FB Ad Contents4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If18": {
      "main": [
        [
          {
            "node": "Get FB Ad Sets4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If19": {
      "main": [
        [
          {
            "node": "Wait4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Accounts4": {
      "main": [
        [
          {
            "node": "Split Out19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Campaigns4": {
      "main": [
        [
          {
            "node": "Split Out20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Sets4": {
      "main": [
        [
          {
            "node": "Split Out21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Contents4": {
      "main": [
        [
          {
            "node": "Code in JavaScript16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch5": {
      "main": [
        [
          {
            "node": "Add Account Name4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Account Name4": {
      "main": [
        [
          {
            "node": "Get Ad Campaigns4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript16": {
      "main": [
        [
          {
            "node": "Split Out4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar Ativos3": {
      "main": [
        [
          {
            "node": "Tem VÃ­deo?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tem VÃ­deo?3": {
      "main": [
        [
          {
            "node": "Formatar Campos Facebook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Campos Facebook3": {
      "main": [
        [
          {
            "node": "Salvar no Airtable3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salvar no Airtable3": {
      "main": [
        [
          {
            "node": "Buscar Dados PerÃ­odo3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo3": {
      "main": [
        [
          {
            "node": "Code in JavaScript17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados3": {
      "main": [
        [
          {
            "node": "Formatar Mensagem3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem3": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out4": {
      "main": [
        [
          {
            "node": "Filtrar Ativos3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript17": {
      "main": [
        [
          {
            "node": "Agregar Dados3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger5": {
      "main": [
        [
          {
            "node": "Get FB Ad Accounts5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out22": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out23": {
      "main": [
        [
          {
            "node": "If20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out24": {
      "main": [
        [
          {
            "node": "If21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait5": {
      "main": [
        [
          {
            "node": "Get FB Ad Contents5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If20": {
      "main": [
        [
          {
            "node": "Get FB Ad Sets5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If21": {
      "main": [
        [
          {
            "node": "Wait5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Accounts5": {
      "main": [
        [
          {
            "node": "Split Out22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ad Campaigns5": {
      "main": [
        [
          {
            "node": "Split Out23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Sets5": {
      "main": [
        [
          {
            "node": "Split Out24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get FB Ad Contents5": {
      "main": [
        [
          {
            "node": "Code in JavaScript18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Add Account Name5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Add Account Name5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Account Name5": {
      "main": [
        [
          {
            "node": "Get Ad Campaigns5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript18": {
      "main": [
        [
          {
            "node": "Split Out5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar Ativos4": {
      "main": [
        [
          {
            "node": "Tem VÃ­deo?4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tem VÃ­deo?4": {
      "main": [
        [
          {
            "node": "Formatar Campos Facebook4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Campos Facebook4": {
      "main": [
        [
          {
            "node": "Salvar no Airtable4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salvar no Airtable4": {
      "main": [
        [
          {
            "node": "Buscar Dados PerÃ­odo4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo4": {
      "main": [
        [
          {
            "node": "Code in JavaScript19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados4": {
      "main": [
        [
          {
            "node": "Formatar Mensagem4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem4": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out5": {
      "main": [
        [
          {
            "node": "Filtrar Ativos4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript19": {
      "main": [
        [
          {
            "node": "Agregar Dados4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Code in JavaScript20",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados": {
      "main": [
        [
          {
            "node": "Formatar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Agregar Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo5": {
      "main": [
        [
          {
            "node": "Agregar Dados5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados5": {
      "main": [
        [
          {
            "node": "Formatar Mensagem5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Agregar Dados5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Dados PerÃ­odo6": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agregar Dados6": {
      "main": [
        [
          {
            "node": "Formatar Mensagem6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Mensagem6": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript20": {
      "main": [
        [
          {
            "node": "Agregar Dados6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Send WhatsApp Report8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "versionId": "20455964-aad3-412d-9223-8d33a52a6a18",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9d65e6caa0e89e696b77790e020391d74468b15f71b3dcdb63aad81f090f5e69"
  },
  "id": "LnASPbaM5ptlLiBH",
  "tags": [
    {
      "updatedAt": "2025-10-26T00:06:22.546Z",
      "createdAt": "2025-10-26T00:06:22.546Z",
      "id": "Sds5CWpQF3mc5wIH",
      "name": "Notification"
    }
  ]
}