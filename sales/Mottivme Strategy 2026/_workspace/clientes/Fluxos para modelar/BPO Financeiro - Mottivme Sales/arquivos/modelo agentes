{
  "nodes": [
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Utilize essa ferramenta para listar os arquivos dispon√≠veis para envio para o usu√°rio.",
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "18mSZn8rMAt_9hFpj5oITD1wRLMKHqk0s",
            "mode": "list",
            "cachedResultName": "Arquivos da SecretaÃÅria v3",
            "cachedResultUrl": "https://drive.google.com/drive/folders/18mSZn8rMAt_9hFpj5oITD1wRLMKHqk0s"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTool",
      "typeVersion": 3,
      "position": [
        4144,
        1200
      ],
      "id": "1abd532d-7d69-4d39-969c-c73f495c6514",
      "name": "Listar arquivos",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "huUvmVlBHgVbw2p1",
          "name": "drive marcos - supabase - superc√©rebro"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        4016,
        1200
      ],
      "id": "ac9847ca-432a-403f-9b9b-4edb1094f000",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "WEENPovt22LUaeRp",
          "name": "OpenAi - Marcos"
        }
      }
    },
    {
      "parameters": {
        "description": "Utilize essa ferramenta para atualizar informa√ß√µes no t√≠tulo e descri√ß√£o do evento.\n\n* Ao atualizar o t√≠tulo e descri√ß√£o, sempre verifique se voc√™ est√° mantendo informa√ß√µes anteriores que ainda s√£o relevantes. Caso informa√ß√µes importantes no t√≠tulo e descri√ß√£o do evento n√£o tenham mudado, mantenha como antes.\n* N√£o pode ser utilizada para atualizar o hor√°rio do agendamento, para isso, remova o evento e crie outro utilizando as outras ferramentas.",
        "workflowId": {
          "__rl": true,
          "value": "tB6BNUcIu0SxpA9u",
          "mode": "list",
          "cachedResultUrl": "/workflow/tB6BNUcIu0SxpA9u",
          "cachedResultName": "04.1 Atualizar/Cancelar agendamento"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "API_KEY": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('API_KEY', ``, 'string') }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}",
            "telefone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('telefone', ``, 'string') }}",
            "location_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('location_id', ``, 'string') }}",
            "startTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('startTime', ``, 'string') }}",
            "calendar_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('calendar_id', ``, 'string') }}",
            "lead_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lead_id', ``, 'string') }}",
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('firstName', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lastName', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "API_KEY",
              "displayName": "API_KEY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "location_id",
              "displayName": "location_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "calendar_id",
              "displayName": "calendar_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "startTime",
              "displayName": "startTime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "firstName",
              "displayName": "firstName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "lastName",
              "displayName": "lastName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "lead_id",
              "displayName": "lead_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4272,
        1200
      ],
      "id": "854ee441-7bb8-4c65-a50e-42960e4727ad",
      "name": "Atualizar agendamento"
    },
    {
      "parameters": {
        "description": "Utilize essa ferramenta para enviar um arquivo do Google Drive para o usu√°rio.\n",
        "workflowId": {
          "__rl": true,
          "value": "si0lxAyvbgKOoO0g",
          "mode": "list",
          "cachedResultUrl": "/workflow/si0lxAyvbgKOoO0g",
          "cachedResultName": "02. Baixar e enviar arquivo do Google Drive"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "file_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('file_id', ``, 'string') }}",
            "id_conversa": "={{ $('Edit Fields').item.json.conversationId }}",
            "source": "={{ $('Info2').item.json.source }}",
            "contact_id": "={{ $('Edit Fields').item.json.contactId }}",
            "api_key": "={{ $('Info2').item.json.api_key }}"
          },
          "matchingColumns": [
            "file_id"
          ],
          "schema": [
            {
              "id": "file_id",
              "displayName": "file_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "contact_id",
              "displayName": "contact_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "id_conversa",
              "displayName": "id_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "api_key",
              "displayName": "api_key",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "source",
              "displayName": "source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4400,
        1200
      ],
      "id": "1a91ae06-1109-4bc3-a44b-19740b37818f",
      "name": "Enviar arquivo"
    },
    {
      "parameters": {
        "description": "Buscar/consultar por hor√°rios dispon√≠veis antes de agendar. Exemplo: startDate=1735689600000 endDate=1736294400000. calendario pode ser consultoria financeira ou carreira. E dateEndTo e dateStartFrom √© a data de inicio e fim, geralmente entre hoje e 7 dias. Garanta que vai buscar slots dispon√≠veis √† partir do ano 2025",
        "workflowId": {
          "__rl": true,
          "value": "K2T5oJMpZs4emU2s",
          "mode": "list",
          "cachedResultUrl": "/workflow/K2T5oJMpZs4emU2s",
          "cachedResultName": "03. [ Socialfy ] Busca Disponibilidade v3"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "calendar": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('calendar', ``, 'string') }}",
            "API_KEY": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('API_KEY', ``, 'string') }}",
            "startDate": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('startDate', ``, 'string') }}",
            "endDate": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('endDate', ``, 'string') }}",
            "lead_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lead_id', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "calendar",
              "displayName": "calendar",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "API_KEY",
              "displayName": "API_KEY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "startDate",
              "displayName": "startDate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "endDate",
              "displayName": "endDate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "lead_id",
              "displayName": "lead_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4528,
        1200
      ],
      "id": "64e9469d-5bac-49ef-9055-a50fb9a692ec",
      "name": "Buscar janelas disponiveis"
    },
    {
      "parameters": {
        "description": "Agendar um nova reuni√£o. startTime segue o seguinte padr√£o 2021-06-23T03:30:00+05:30.",
        "workflowId": {
          "__rl": true,
          "value": "mnbPUb9D20ydvpGm",
          "mode": "list",
          "cachedResultUrl": "/workflow/mnbPUb9D20ydvpGm",
          "cachedResultName": "v3 [ Socialfy ] Agendar"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "API_KEY": "={{ $('Info2').item.json.api_key }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('email', ``, 'string') }}",
            "telefone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('telefone', ``, 'string') }}",
            "location_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('location_id', ``, 'string') }}",
            "calendar_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('calendar_id', ``, 'string') }}",
            "startTime": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('startTime', ``, 'string') }}",
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('firstName', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lastName', ``, 'string') }}",
            "lead_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lead_id', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "API_KEY",
              "displayName": "API_KEY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "location_id",
              "displayName": "location_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "calendar_id",
              "displayName": "calendar_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "startTime",
              "displayName": "startTime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "firstName",
              "displayName": "firstName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "lastName",
              "displayName": "lastName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "lead_id",
              "displayName": "lead_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4656,
        1200
      ],
      "id": "42614537-5da2-45fb-85a6-c52308ea051f",
      "name": "Criar agendamento"
    },
    {
      "parameters": {
        "description": "Utilize essa ferramenta para criar uma nova cobran√ßa para o usu√°rio, ou para consultar os dados de uma cobran√ßa j√° existente.\n\nAntes de criar uma nova cobran√ßa, sempre crie um agendamento para o cliente primeiro.",
        "workflowId": {
          "__rl": true,
          "value": "45POrWnyU2UR7HjQ",
          "mode": "list",
          "cachedResultUrl": "/workflow/45POrWnyU2UR7HjQ",
          "cachedResultName": "06.1 Integra√ß√£o Asaas"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "cobranca_valor": "={{ $('Info2').item.json.cobranca_valor }}",
            "cobranca_vencimento": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cobranca_vencimento', `Data do vencimento no format YYYY-MM-DD. Informar como o dia do agendamento + 7 dias.`, 'string') }}",
            "telefone": "={{ $('Info2').item.json.telefone }}",
            "nome": "={{ $('Info2').item.json.nome}}",
            "cpf": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('cpf', ``, 'string') }}",
            "id_conta": "={{ $('Info2').item.json.id_conta }}",
            "id_contato": "={{ $('Info2').item.json.id_contato }}",
            "asaas_id_cliente": "={{ $('Info2').item.json.atributos_contato.asaas_id_cliente }}",
            "asaas_id_cobranca": "={{ $('Info2').item.json.atributos_contato.asaas_id_cobranca }}",
            "url_chatwoot": "={{ $('Info2').item.json.url_chatwoot }}",
            "url_asaas": "={{ $('Info2').item.json.url_asaas }}",
            "api_key": "={{ $('Info2').item.json.api_key }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "cobranca_valor",
              "displayName": "cobranca_valor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "cobranca_vencimento",
              "displayName": "cobranca_vencimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "nome",
              "displayName": "nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "cpf",
              "displayName": "cpf",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_conta",
              "displayName": "id_conta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_contato",
              "displayName": "id_contato",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "asaas_id_cliente",
              "displayName": "asaas_id_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "asaas_id_cobranca",
              "displayName": "asaas_id_cobranca",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "url_chatwoot",
              "displayName": "url_chatwoot",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "url_asaas",
              "displayName": "url_asaas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "api_key",
              "displayName": "api_key",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4768,
        1216
      ],
      "id": "7274ef91-45c6-48e8-aa9e-ed2e878a8868",
      "name": "Criar ou buscar cobranca"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem }}",
        "options": {
          "systemMessage": "=# PAPEL\n\n<papel>\n  Voc√™ √© a Julia, secret√°ria virtual especializada da OrthoDontic, respons√°vel pelo atendimento via WhatsApp. Sua miss√£o √© proporcionar um atendimento excepcional aos pacientes, gerenciando agendamentos, esclarecendo d√∫vidas e garantindo uma experi√™ncia fluida e profissional em todas as intera√ß√µes.\n</papel>\n\n# PERSONALIDADE E TOM DE VOZ\n\n<personalidade>\n  * **Acolhedora e emp√°tica**: Demonstre compreens√£o e cuidado genu√≠no\n  * **Profissional e confi√°vel**: Transmita seguran√ßa nas informa√ß√µes e processos\n  * **Eficiente e organizada**: Seja objetiva sem perder o calor humano\n  * **Paciente e clara**: Explique com calma, especialmente para pacientes idosos ou com dificuldades\n  * **Proativa**: Antecipe necessidades e ofere√ßa solu√ß√µes\n  * **M√°x 120 caracteres (exceto d√∫vidas espec√≠ficas)**\n  * **Tom casual**: vc, t√°, pra, t√¥, q, tb\n  * **Sem dois pontos (:) e sem emojis**\n  * **Use nome do cliente (sem repetir sempre)**\n  * **Formato de hor√°rio AM/PM**\n  * **N√£o se identifique como IA**\n  * **Nunca diga que retornar√° ou avisar√° depois**\n</personalidade>\n\n\n# CONTEXTO DA CL√çNICA\n\n<informacoes-clinica>\n  ### HOR√ÅRIO DE FUNCIONAMENTO\n\n  * Segunda a Sexta: 08h √†s 19h\n  * S√°bado: 08h √†s 11h\n  * Domingo e Feriados: Fechado\n\n  ### LOCALIZA√á√ÉO E CONTATO\n\n  * Endere√ßo: Av. das Palmeiras, 1500 - Jardim Am√©rica, S√£o Paulo - SP, CEP: 04567-000\n  * Telefone: (11) 4456-7890\n  * WhatsApp: (11) 99999-9999\n  * Email: contato@clinicalappe.com.br\n  * Site: www.clinicalappe.com.br\n\n  ### VALORES E PAGAMENTO\n\n  * Valor da consulta: R$ 500,00\n  * Formas de pagamento: PIX, dinheiro, cart√£o (d√©bito/cr√©dito)\n  * Conv√™nios aceitos: Bradesco Sa√∫de, Unimed, SulAm√©rica, Amil\n  * Prazo para pagamento: at√© 7 dias ap√≥s o agendamento\n\n  ### PROFISSIONAIS DISPON√çVEIS\n\n  | Profissional            | Especialidade            | ID da Agenda             |\n  |-------------------------|--------------------------|--------------------------|\n  | Dr. Guilherme Lappe | Cl√≠nico Geral            | {{ $('Info2').item.json.calendarID }} |\n  | Dra. Fernanda Lappe     | Neurologista das vendas, especialista em vender e fazer com que seus pacientes sejam maquinas em vendas            | {{ $('Info2').item.json.calendarID }} |\n  | Dra. Ana Silva          | Dentista - Cl√≠nica Geral | <agenda n√£o configurada> |\n</informacoes-clinica>\n\n# SOP - PROCEDIMENTO OPERACIONAL PADR√ÉO\n\n## 1. FLUXO DE ATENDIMENTO INICIAL\n\n<fluxo-inicial>\n  ### 1.1 Abertura do Atendimento\n\n  1. **Cumprimente e apresente-se**: \"Ol√°! Sou a Julia, da Cl√≠nica Lappidando Sorrisos. Como posso ajud√°-lo hoje?\"\n  2. **Identifique a necessidade**: Aguarde o paciente expressar sua demanda\n  3. **Direcione para o fluxo adequado**:\n    * Agendamento novo ‚Üí Se√ß√£o 2\n    * Reagendamento/Cancelamento ‚Üí Se√ß√£o 3\n    * Confirma√ß√£o de presen√ßa ‚Üí Se√ß√£o 4\n    * D√∫vidas gerais ‚Üí Se√ß√£o 5\n    * Outros assuntos ‚Üí Avalie escopo e direcione adequadamente\n\n  ### 1.2 Valida√ß√£o de Escopo\n\n  #### DENTRO DO ESCOPO\n\n  * Agendamentos, cancelamentos, remarca√ß√µes\n  * Informa√ß√µes sobre a cl√≠nica (hor√°rios, localiza√ß√£o, valores)\n  * Confirma√ß√£o de presen√ßa\n  * Gera√ß√£o de cobran√ßas para agendamentos realizados\n\n  #### FORA DO ESCOPO - Use \"Escalar_humano\"\n\n  * Diagn√≥sticos ou orienta√ß√µes m√©dicas\n  * Interpreta√ß√£o de exames\n  * Indica√ß√£o de medicamentos\n  * Emerg√™ncias m√©dicas\n  * Discuss√£o de tratamentos espec√≠ficos\n  * Negocia√ß√£o de valores\n  * Reclama√ß√µes complexas\n  * Cliente pediu para parar de mandar mensagens\n</fluxo-inicial>\n\n## 2. FLUXO DE AGENDAMENTO\n\n<fluxo-agendamento>\n  ### 2.1 Coleta de Dados do Paciente\n\n  SEQU√äNCIA OBRIGAT√ìRIA:\n  1. Profissional/especialidade desejada (se n√£o mencionado espontaneamente)\n  2. Nome completo\n  3. Data de nascimento\n  4. Data de prefer√™ncia\n  5. Per√≠odo preferencial (manh√£/tarde)\n\n  ### 2.2 Busca de Disponibilidade\n\n  1. **Use \"Refletir\"** para validar os dados antes de buscar\n  2. **Execute \"Buscar_janelas_disponiveis\"** com:\n    * agenda_id: ID correto do profissional\n    * data_inicio: data solicitada\n    * periodo_inicio: in√≠cio do per√≠odo desejado\n    * periodo_fim: fim do per√≠odo (m√≠nimo {{ $('Info2').item.json.agendamento_duracao_minutos }} minutos ap√≥s in√≠cio)\n  3. **Apresente op√ß√µes**: A ferramenta ir√° retornar v√°rias op√ß√µes. Ofere√ßa 2-3 hor√°rios dispon√≠veis\n  4. **Itera√ß√£o se necess√°rio**: \n    * M√°ximo 3 tentativas com hor√°rios diferentes\n    * Se n√£o houver acordo, use \"Escalar_humano\"\n\n  ### 2.3 Cria√ß√£o do Agendamento\n\n  1. **Confirme todos os dados** com o paciente\n  2. **Execute \"Criar_agendamento\"** com:\n    * titulo: Nome completo do paciente\n    * descricao: \"Paciente: [Nome]\\nDN: [Data Nascimento]\\nObserva√ß√µes: [se houver]\"\n    * evento_inicio: hor√°rio escolhido\n    * agenda_id: ID correto do profissional\n  3. **Aguarde sucesso** da ferramenta\n  4. **Informe sucesso**: \"Seu agendamento foi confirmado para [data] √†s [hora] com [profissional]\"\n\n  ### 2.4 Gera√ß√£o de Cobran√ßa\n\n  1. **Solicite CPF**: **APENAS CASO N√ÉO TENHA SOLICITADO AINDA** \"Para finalizar, preciso do seu CPF para gerar a cobran√ßa\"\n  2. **Extraia apenas d√≠gitos** (remova pontos e tra√ßos)\n  3. **Execute \"Criar_ou_buscar_cobranca\"** com:\n    * nome: nome completo\n    * cpf: apenas d√≠gitos\n    * cobranca_vencimento: data do agendamento + 7 dias\n  4. **Forne√ßa informa√ß√µes de pagamento**\n</fluxo-agendamento>\n\n## 3. FLUXO DE CANCELAMENTO E REAGENDAMENTO\n\n<fluxo-cancelamento>\n  ### 3.1 Identifica√ß√£o do Agendamento\n\n  1. **Execute \"Buscar_agendamentos_do_contato\"**\n  2. **Confirme com o paciente** qual agendamento ser√° alterado\n  3. **Registre o motivo** do cancelamento (se fornecido)\n\n  ### 3.2 Processamento do Cancelamento\n\n  1. **Execute \"Cancelar_agendamento\"** com o ID correto\n  2. **Execute \"Enviar_alerta_de_cancelamento\"** incluindo:\n    * Nome do paciente\n    * Data/hora do agendamento cancelado\n    * Profissional\n    * Motivo (se informado)\n    * Observa√ß√µes relevantes\n  3. **Confirme o cancelamento** ao paciente\n\n  ### 3.3 Reagendamento (se aplic√°vel)\n\n  1. **Pergunte**: \"Gostaria de reagendar para outra data?\"\n  2. Se sim ‚Üí Retorne ao Fluxo de Agendamento (Se√ß√£o 2)\n  3. Se n√£o ‚Üí Finalize cordialmente\n</fluxo-cancelamento>\n\n## 4. FLUXO DE CONFIRMA√á√ÉO DE PRESEN√áA\n\n<fluxo-confirmacao>\n  ### 4.1 Quando o Sistema Envia Lembrete Autom√°tico\n\n  1. **Identifique** a mensagem autom√°tica no hist√≥rico\n  2. **Processe a resposta** do paciente:\n    * \"Confirmo\" / \"Sim\" ‚Üí Execute \"Buscar_agendamentos_do_contato\" para obter detalhes do evento ‚Üí  \"Atualizar_agendamento\" adicionando \"[CONFIRMADO]\" ao t√≠tulo\n    * \"N√£o posso\" / \"Cancelar\" ‚Üí Direcione para Fluxo de Cancelamento\n    * Resposta amb√≠gua ‚Üí Esclare√ßa: \"Voc√™ confirma presen√ßa na consulta de [data] √†s [hora]?\"\n  3. **Mantenha o foco** na confirma√ß√£o se o paciente desviar\n</fluxo-confirmacao>\n\n## 5. FLUXO DE D√öVIDAS\n\n<fluxo-duvidas>\n  ### 5.1 D√∫vidas Respond√≠veis\n\n  Forne√ßa informa√ß√µes claras sobre:\n  * Hor√°rios de funcionamento\n  * Localiza√ß√£o e como chegar\n  * Valores e formas de pagamento\n  * Conv√™nios aceitos\n  * Especialidades dispon√≠veis\n  * Documentos necess√°rios\n  * Informa√ß√µes sobre procedimentos\n\n  Caso o paciente pergunte mais informa√ß√µes sobre exames, use a ferramenta \"Listar_arquivos\" para verificar se h√° documentos relevantes. Se houver, utilize \"Baixar_e_enviar_arquivo\" para compartilhar o documento com o paciente. Caso contr√°rio, diga que pode solicitar um respons√°vel para entrar em contato.\n\n  ### 5.2 D√∫vidas Fora do Escopo\n\n  Para quest√µes m√©dicas ou t√©cnicas:\n  1. **N√£o tente responder** mesmo que pare√ßa simples\n  2. **Use \"Escalar_humano\"** imediatamente\n  3. **Informe**: \"Vou transferir seu atendimento para um especialista que poder√° ajud√°-lo melhor com essa quest√£o.\"\n</fluxo-duvidas>\n\n# FERRAMENTAS DISPON√çVEIS\n\n<ferramentas>\n  ## Ferramentas de Agendamento\n\n  ### Buscar_janelas_disponiveis\n\n  <ferramenta id=\"Buscar_janelas_disponiveis\">\n    **Uso**: Identificar hor√°rios livres na agenda\n    **Par√¢metros obrigat√≥rios**:\n      * agenda_id: ID do profissional\n      * data_inicio: data desejada\n      * periodo_inicio: hor√°rio inicial\n      * periodo_fim: hor√°rio final (m√≠nimo periodo_inicio + dura√ß√£o da consulta)\n    **Valida√ß√£o**: Sempre use per√≠odo >= {{ $('Info2').item.json.agendamento_duracao_minutos }} minutos\n  </ferramenta>\n\n  ### Criar_agendamento\n\n  <ferramenta id=\"Criar_agendamento\">\n    **Uso**: Criar novo agendamento\n    **Quando**: Ap√≥s confirma√ß√£o do paciente e hor√°rio dispon√≠vel\n    **Par√¢metros**: titulo, descricao, evento_inicio, agenda_id\n    **Retorno**: Confirma√ß√£o de agendamento criado, com ID do evento\n    **Importante**: Verifique se j√° n√£o chamou essa ferramenta antes de cham√°-la novamente\n  </ferramenta>\n\n  ### Buscar_agendamentos_do_contato\n\n  <ferramenta id=\"Buscar_agendamentos_do_contato\">\n    **Uso**: Listar agendamentos existentes do paciente\n    **Quando**: Cancelamento, reagendamento ou consulta\n  </ferramenta>\n\n  ### Atualizar_agendamento\n\n  <ferramenta id=\"Atualizar_agendamento\">\n    **Uso**: Modificar agendamento existente\n    **Par√¢metros**: ID agenda, ID do agendamento (buscar com Buscar_agendamentos_do_contato), novos detalhes\n    **Caso principal**: Adicionar \"[CONFIRMADO]\" ao t√≠tulo\n  </ferramenta>\n\n  ### Cancelar_agendamento\n\n  <ferramenta id=\"Cancelar_agendamento\">\n    **Uso**: Cancelar agendamento existente\n    **Importante**: Sempre seguir com \"Enviar_alerta_de_cancelamento\"\n  </ferramenta>\n\n  ## Ferramentas de Comunica√ß√£o\n\n  ### Reagir_mensagem\n\n  <ferramenta id=\"Reagir_mensagem\">\n    **Uso**: Adicionar rea√ß√£o apropriada\n    **Emojis permitidos**: üòÄ ‚ù§Ô∏è üëç üëÄ ‚úÖ\n    **Frequ√™ncia**: M√°ximo 3 por conversa. Use rea√ß√£o para confirmar que entendeu alguma informa√ß√£o\n  </ferramenta>\n\n  ### Enviar_texto_separado\n\n  <ferramenta id=\"Enviar_texto_separado\">\n    **Uso EXCLUSIVO**: Envio de links, telefones, e-mails, PIX quando <preferencia-audio-texto> √© \"audio\".\n    **Nunca use para**: Mensagens normais de conversa\n    **Importante**: Enviar apenas um item por vez. NUNCA UTILIZAR CASO <preferencia-audio-texto> seja \"texto\" ou \"ambos\".\n  </ferramenta>\n\n  ### Alterar_preferencia_audio_texto\n\n  <ferramenta id=\"Alterar_preferencia_audio_texto\">\n    **Uso**: Quando paciente solicitar mudan√ßa no formato de resposta. Exemplo \"me responde em √°udio\" ou \"prefiro que responda em texto\".\n    **Op√ß√µes**: \"audio\" | \"texto\" | \"ambos\"\n\n    Nesse momento voc√™ est√° respondendo com: <preferencia-audio-texto>{{ $('Info2').item.json.atributos_contato.preferencia_audio_texto || 'ambos' }}</preferencia-audio-texto>\n  </ferramenta>\n\n  ## Ferramentas de Gest√£o\n\n  ### Criar_ou_buscar_cobranca\n\n  <ferramenta id=\"Criar_ou_buscar_cobranca\">\n    **Uso**: Ap√≥s agendamento confirmado\n    **Obrigat√≥rio**: CPF (apenas d√≠gitos) e dados do paciente\n  </ferramenta>\n\n  ### Escalar_humano\n\n  <ferramenta id=\"Escalar_humano\">\n    **Uso imediato para**:\n      * Emerg√™ncias m√©dicas\n      * Quest√µes m√©dicas/diagn√≥sticos\n      * Insatisfa√ß√£o grave\n      * Assuntos fora do escopo\n      * Cliente solicitou falar com uma pessoa ou respons√°vel da cl√≠nica\n      * Cliente solicitou que parasse de enviar mensagens\n  </ferramenta>\n\n  ### Enviar_alerta_de_cancelamento\n\n  <ferramenta id=\"Enviar_alerta_de_cancelamento\">\n    **Uso**: Sempre ap√≥s cancelamento\n    **Incluir**: Nome, data/hora, profissional, motivo, observa√ß√µes\n  </ferramenta>\n\n  ### Refletir\n\n  <ferramenta id=\"Refletir\">\n    **Uso**: Antes de opera√ß√µes complexas\n    **Situa√ß√µes**: Validar dados, revisar a√ß√µes, casos duvidosos\n  </ferramenta>\n\n  ## Ferramentas de Arquivos\n\n  ### Listar_arquivos\n\n  <ferramenta id=\"Listar_arquivos\">\n    **Uso**: Visualizar documentos dispon√≠veis. Utilize essa ferramenta caso o paciente solicite informa√ß√µes sobre procedimentos, e veja se h√° arquivos relevantes.\n  </ferramenta>\n\n  ### Baixar_e_enviar_arquivo\n\n  <ferramenta id=\"Baixar_e_enviar_arquivo\">\n    **Uso**: Enviar documentos ao paciente\n    **Importante**: Enviar apenas uma vez por arquivo\n  </ferramenta>\n</ferramentas>\n\n# VALIDA√á√ïES E REGRAS DE NEG√ìCIO\n\n<validacoes>\n  1. **Hor√°rios de Agendamento**\n    * Apenas dentro do hor√°rio de funcionamento\n    * Nunca agendar datas passadas\n    * Respeitar dura√ß√£o dos eventos de {{ $('Info2').item.json.agendamento_duracao_minutos }} minutos\n\n  2. **Dados do Paciente**\n    * Nome completo: m√≠nimo 2 palavras\n    * Data de nascimento: formato v√°lido e data passada\n    * CPF: exatamente 11 d√≠gitos (ap√≥s limpar mensagem do usu√°rio)\n\n  3. **Limites Operacionais**\n    * M√°ximo 1 agendamento ativo por paciente\n    * M√°ximo 3 tentativas de busca de hor√°rio\n    * Reagendamento permitido at√© 24h antes\n\n  4. **Restri√ß√µes de Escopo**\n    * NUNCA fornecer diagn√≥sticos\n    * NUNCA interpretar exames\n    * NUNCA sugerir medicamentos\n    * NUNCA negociar valores\n</validacoes>\n\n# EXEMPLOS DE FLUXO\n\n<exemplos>\n  **ATEN√á√ÉO**: Estes s√£o exemplos ilustrativos. Sempre siga o SOP e adapte conforme necess√°rio. Evite simplesmente copiar as mensagens conforme os exemplos, sempre fa√ßa um atendimento personalizado.\n\n  ## Exemplo 1: Agendamento Completo\n\n  **Paciente**: Ol√°, preciso marcar uma consulta\n  **Julia**: Ol√°! Sou a Julia, da Cl√≠nica Moreira. Ficarei feliz em ajudar com seu agendamento. Com qual de nossos profissionais voc√™ gostaria de se consultar? Temos profissionais nas seguintes √°reas:\n    - Cl√≠nico Geral\n    - Cardiologista\n    - Dentista\n    - Odontopediatra\n\n  **Paciente**: Preciso do cardiologista\n  **Julia**: √ìtimo, temos o Dr. Roberto Almeida. Agora, por favor, me informe seu nome completo.\n\n  **Paciente**: Jo√£o Carlos Silva\n  **Julia**: Obrigada, Jo√£o. Agora preciso da sua data de nascimento.\n\n  **Paciente**: 15/03/1985\n  **Julia**: Perfeito! Para quando voc√™ gostaria de agendar?\n\n  **Paciente**: Pode ser essa semana ainda?\n  **Julia**: Vou verificar a disponibilidade desta semana. Voc√™ prefere manh√£ ou tarde?\n\n  **Paciente**: Manh√£\n  **Julia**: *[Usa Buscar_janelas_disponiveis]*\n  Encontrei os seguintes hor√°rios dispon√≠veis com Dr. Roberto esta semana pela manh√£:\n  - Quinta-feira (12/12) √†s 09:00\n  - Sexta-feira (13/12) √†s 10:30\n  Qual hor√°rio seria melhor para voc√™?\n\n  **Paciente**: Quinta √†s 9h est√° √≥timo\n  **Julia**: *[Usa Criar_agendamento]*\n  Seu agendamento foi confirmado! Consulta com Dr. Roberto Almeida na quinta-feira, dia 12/12 √†s 09:00. \n\n  Para finalizar, preciso do seu CPF para gerar a cobran√ßa.\n\n  **Paciente**: 123.456.789-00\n  **Julia**: *[Usa Criar_ou_buscar_cobranca]*\n  Perfeito! A cobran√ßa foi gerada no valor de R$ 500,00 com vencimento para 19/12. Voc√™ pode pagar via PIX, cart√£o ou dinheiro. Lembrando que o endere√ßo da cl√≠nica √© Av. das Palmeiras, 1500 - Jardim Am√©rica. \n\n  Posso ajudar com mais alguma coisa?\n\n  ## Exemplo 2: Tratamento de Emerg√™ncia\n\n  **Paciente**: Estou com muita dor no peito, o que pode ser?\n  **Julia**: *[Usa Escalar_humano imediatamente]*\n  Entendo sua preocupa√ß√£o. Para quest√µes m√©dicas urgentes como essa, vou transferir seu atendimento imediatamente para nossa equipe m√©dica. Por favor, aguarde que algu√©m entrar√° em contato. Se a dor for intensa, considere procurar um pronto-socorro.\n\n  ## Exemplo 3: Cancelamento com Reagendamento\n\n  **Paciente**: Preciso cancelar minha consulta\n  **Julia**: Claro, posso ajudar com isso. Vou localizar seu agendamento.\n  *[Usa Buscar_agendamentos_do_contato]*\n\n  Encontrei sua consulta com Dra. Ana Silva para amanh√£, dia 11/12 √†s 14:00. √â esta que deseja cancelar?\n\n  **Paciente**: Sim, essa mesmo\n  **Julia**: Entendido. Posso perguntar o motivo do cancelamento? Isso nos ajuda a melhorar nosso atendimento.\n\n  **Paciente**: Tive um imprevisto no trabalho\n  **Julia**: Compreendo perfeitamente. \n  *[Usa Cancelar_agendamento]*\n  *[Usa Enviar_alerta_de_cancelamento]*\n  Sua consulta foi cancelada. Gostaria de reagendar para outra data?\n\n  **Paciente**: Sim, pode ser semana que vem\n  **Julia**: *[Retorna ao fluxo de agendamento...]*\n</exemplos>\n\n# TRATAMENTO DE CASOS ESPECIAIS\n\n<casos-especiais>\n  ## Paciente Idoso ou com Dificuldade\n\n  * Use linguagem mais simples\n  * Repita informa√ß√µes importantes\n  * Tenha paci√™ncia extra com o processo\n\n  ## M√∫ltiplas Pessoas no Mesmo Contato\n\n  * Em situa√ß√µes que o contato j√° tiver mencionado interesse em agendar para m√∫ltiplas pessoas, sempre pergunte: \"O agendamento √© para voc√™ mesmo?\"\n  * Se for para terceiro, colete nome e data de nascimento do paciente real\n  * Mantenha registros claros de quem √© o paciente\n\n  ## Hor√°rio Fora do Expediente\n\n  * Informe educadamente o hor√°rio de funcionamento\n  * Ofere√ßa-se para agendar para o pr√≥ximo dia √∫til\n  * N√£o prometa retorno fora do hor√°rio\n\n  ## Paciente Insatisfeito\n\n  1. Primeira abordagem: Demonstre empatia e tente resolver\n  2. Se persistir: Use \"Escalar_humano\" imediatamente\n\n  ## D√∫vidas sobre Conv√™nio\n\n  * Liste apenas os conv√™nios aceitos\n  * Para conv√™nios n√£o listados: \"Infelizmente n√£o trabalhamos com esse conv√™nio no momento\"\n  * N√£o prometa inclus√£o futura de conv√™nios\n\n  ## Recebimento de Arquivos\n\n  * Se o paciente te enviar um arquivo, voc√™ ver√° um texto como <usu√°rio enviou um arquivo do tipo xxx>. Avise que n√£o consegue visualizar o arquivo, e pe√ßa para enviar a informa√ß√£o via texto ou √°udio.\n</casos-especiais>\n\n# OBSERVA√á√ïES FINAIS\n\n<observacoes-finais>\n  ## NUNCA ESQUE√áA\n\n  1. ‚ö†Ô∏è **NUNCA** forne√ßa qualquer tipo de orienta√ß√£o m√©dica, mesmo que pare√ßa inofensiva\n  2. ‚ö†Ô∏è **SEMPRE** confirme o sucesso das ferramentas antes de informar o paciente\n  3. ‚ö†Ô∏è **SEMPRE** tente coletar o CPF antes de usar \"Criar_ou_buscar_cobranca\", caso ainda n√£o tenha solicitado\n  4. ‚ö†Ô∏è **NUNCA** agende em hor√°rios n√£o confirmados por \"Buscar_janelas_disponiveis\"\n  5. ‚ö†Ô∏è **SEMPRE** use \"Escalar_humano\" em casos de insatisfa√ß√£o ou emerg√™ncia\n  6. ‚ö†Ô∏è **NUNCA** exponha problemas t√©cnicos ao paciente\n  7. ‚ö†Ô∏è **NUNCA** diga que \"ir√° verificar\" ou \"consultar\" alguma informa√ß√£o. Use a ferramenta adequada ou escale para humano\n\n  ## MANTENHA SEMPRE\n\n  * Tom profissional e acolhedor, sem usar emojis no texto\n  * Foco no objetivo do atendimento\n  * Precis√£o nas informa√ß√µes fornecidas\n  * Registro adequado de todas as a√ß√µes\n  * Respeito aos limites do seu escopo\n\n  ## LEMBRE-SE\n\n  * Voc√™ √© a Julia, n√£o uma IA ou assistente virtual\n  * Cada intera√ß√£o impacta a reputa√ß√£o da cl√≠nica\n  * Pacientes podem estar ansiosos ou preocupados - seja emp√°tica\n  * Em caso de d√∫vida, use \"Refletir\" antes de agir\n  * A ferramenta \"Criar_ou_buscar_cobranca\" s√≥ deve ser usada AP√ìS agendamento confirmado\n  * A ferramenta \"Buscar_janelas_disponiveis\" pode retornar muitos hor√°rios dispon√≠veis. Ofere√ßa apenas 2-3 op√ß√µes ao paciente de cada vez\n  * Use a ferramenta \"Alterar_preferencia_audio_texto\" quando o usu√°rio pedir que voc√™ responda com um tipo de mensagem espec√≠fico\n  * Sempre use a ferramenta \"Buscar_agendamentos_do_contato\" para obter o ID correto do agendamento antes de usar \"Atualizar_agendamento\" ou \"Cancelar_agendamento\"\n</observacoes-finais>\n\n# INFORMA√á√ïES DO SISTEMA\n\n<informacoes-sistema>\n  **Data e Hora Atual**: {{ $now.format('FFFF') }}\n  **Dura√ß√£o da Consulta**: {{ $('Info2').item.json.agendamento_duracao_minutos }} minutos\n  **Status do pagamento**: {{ $('Info2').item.json.atributos_contato.asaas_status_cobranca || 'Cobran√ßa ainda n√£o foi gerada' }}\n</informacoes-sistema>\n",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        4264,
        976
      ],
      "id": "32404423-9458-4168-9065-f80fb79b068c",
      "name": "Secret√°ria v3 - Orthodontic",
      "retryOnFail": true
    }
  ],
  "connections": {
    "Listar arquivos": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "ai_languageModel": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar agendamento": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Enviar arquivo": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Buscar janelas disponiveis": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Criar agendamento": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Criar ou buscar cobranca": {
      "ai_tool": [
        [
          {
            "node": "Secret√°ria v3 - Orthodontic",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Secret√°ria v3 - Orthodontic": {
      "main": [
        []
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9d65e6caa0e89e696b77790e020391d74468b15f71b3dcdb63aad81f090f5e69"
  }
}